/*! jspaint 2015-07-02 Anubhav Saini (c) 2015 */
!function(a){"use strict";a(function(){var b={canvasId:"jspaint-canvas",containerId:"jspaint-paint-area",activeToolCursorClass:"working-with-tools",maintoolsClass:"main-tool",basicColors:[{id:"00FFFF",name:"Aqua"},{id:"000000",name:"Black"},{id:"0000FF",name:"Blue"},{id:"FF00FF",name:"Fuchsia"},{id:"808080",name:"Gray"},{id:"008000",name:"Green"},{id:"00FF00",name:"Lime"},{id:"800000",name:"Maroon"},{id:"000080",name:"Navy"},{id:"808000",name:"Olive"},{id:"800080",name:"Purple"},{id:"FF0000",name:"Red"},{id:"C0C0C0",name:"Silver"},{id:"008080",name:"Teal"},{id:"FFFFFF",name:"White"},{id:"FFFF00",name:"Yellow"}]},c=window.location.toString().split("?")[1].split("=")[1],d=c.split("x")[0],e=c.split("x")[1],f="",g="",h="white",i=null,j=function(){for(var c=a("<div></div>"),d=a("<div></div>"),e=c,f=0,g=b.basicColors.length;g>f;f++){e=g/2>f?c:d;var h="#"+b.basicColors[f].id,i=a('<div class="color" id="Color-Hex-'+h+'" style="background-color: '+h+';"></div>');i.appendTo(e)}c.appendTo(".BasicColorPalette"),d.appendTo(".BasicColorPalette")},k=function(){var c=d-2,f=e-2;return a("<canvas/>",{id:b.canvasId}).prop({width:c,height:f}).appendTo("#"+b.containerId),a("#"+b.canvasId)[0].getContext("2d")},l=function(){a("#"+b.canvasId).on("mousemove",function(b){i.fillRect(b.pageX-a(this).offset().left,b.pageY-a(this).offset().top,2,2)})},m=function(){a("#"+b.canvasId).off("mousemove")},n={fillCirc:function(a,b,c){i.beginPath(),i.arc(a,b,c,0,2*Math.PI,!1),i.fill()}},o=function(){a("#"+b.canvasId).on("click",function(b){n.fillCirc(b.pageX-a(this).offset().left,b.pageY-a(this).offset().top,10)})},p=function(){a("#"+b.canvasId).off("click")},q=function(){a("#"+b.canvasId).on("click",function(b){i.fillRect(b.pageX-a(this).offset().left,b.pageY-a(this).offset().top,10,10)})},r=function(){a("#"+b.canvasId).off("click")},s=function(a){return"#"+a.attr("id").split("#")[1]},t=function(c){a("#"+b.canvasId).on("mousemove",function(b){void 0!==b.buttons&&1===b.buttons&&i.fillRect(b.pageX-a(this).offset().left,b.pageY-a(this).offset().top,2,2)})},u=function(c){a("#"+b.canvasId).off("mousemove")},v=function(b,c){null!==x&&x.trigger("click"),a(b.tool).toggleClass("active-tool"),c(b)},w=function(b,c){a(b.tool).toggleClass("active-tool"),c(b)},x=null,y=function(){a("#FreeStyleSpeedDotsTool").funcToggle("click",function(){v({tool:this},l),x=a(this)},function(){x=null,w({tool:this},m)})},z=function(){a("#DiscTool").funcToggle("click",function(){v({tool:this},o),x=a(this)},function(){x=null,w({tool:this},p)})},A=function(){a("#PencilTool").funcToggle("click",function(){v({tool:this},t),x=a(this)},function(){x=null,w({tool:this},u)})},B=function(){a(".color").on("click",function(){g=i.fillStyle=s(a(this))}).on("contextmenu",function(){f=s(a(this))})},C=function(b){a("#"+b.containerId+" #"+b.toolId).on("input",function(){g=i.fillStyle=a(this).val()})},D=function(c){a("#"+c.toolId).on("click",function(){window.open(a("#"+b.canvasId)[0].toDataURL("image/png"),"_blank")})},E=function(c){a("#"+c.toolId).on("click",function(){var c=a("#"+b.canvasId)[0],d=c.height,e=c.width,f=c.getContext("2d");f.save(),f.transform(1,0,0,1,0,0),f.fillStyle=h,f.fillRect(0,0,e,d),f.restore()})},F=function(b){a("#"+b.toolId).funcToggle("click",function(){v({tool:this},q),x=a(this)},function(){x=null,w({tool:this},r)})},G=function(){B(),A(),z(),y(),C({toolId:"allColorsPicker",containerId:"HTML5ColorPicker"}),D({toolId:"save-as-image",containerId:"SaveImageButton"}),E({toolId:"reset-canvas",containerId:"ResetCanvas"}),F({toolId:"SquareTool",containerId:"jspaint-tools"})},H=function(){a("#jspaint-paint-area").css({width:d,height:e})},I=function(){a("."+b.maintoolsClass).attr("title","Click to activate;\nRight-click to deactivate;")},J=function(){a(".top-taker").TopTaker({theme:"dark"})},K=function(){H(),i=k(),I(),J(),j(),G(),a("#PencilTool").trigger("click")},L=function(){if(window.location.href.startsWith("file://")){mocha.setup("bdd"),mocha.reporter("html");var b=chai.assert,c=function(c){describe("Events are installed properly for "+c.name,function(){var d=a(c.selectionCriterion),e=a._data(d[0],"events");it("There is exactly one event.",function(){b(1,e.length)}),it("There is exactly one click event.",function(){b("undefined"!==e.click)})})},d=function(){c({name:"PencilTool",selectionCriterion:"#PencilTool"}),c({name:"SpeedDot",selectionCriterion:"#FreeStyleSpeedDotsTool"}),c({name:"SquareTool",selectionCriterion:"#SquareTool"}),c({name:"SquareTool",selectionCriterion:"#SquareTool"}),c({name:"Reset Canvas",selectionCriterion:"#reset-canvas"}),c({name:"Save Image",selectionCriterion:"#save-as-image"}),c({name:"Color Picker",selectionCriterion:"#allColorsPicker"}),c({name:"DiscTool",selectionCriterion:"#DiscTool"}),c({name:"Basic colors",selectionCriterion:".color"})};describe("Testing.",function(){d()})}navigator.userAgent.indexOf("PhantomJS")<0&&mocha.run()},M=function(){K(),L()};M()})}(jQuery);