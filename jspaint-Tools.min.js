/*! jspaint 2015-09-01 Anubhav Saini (c) 2015 */
$(function(){"use strict";var a={generateSlider:function(a){var b=a.min,c=a.max,d=a.title,e=a.id,f=a.step;return $('<input id="'+e+'" type="range" min="'+b+'" max="'+c+'" step="'+f+'" title="'+d+'" />')},generateLabel:function(a){var b=a.hexColor,c=a.fontSize;return $('<label style="color: #'+b+"; font-size: "+c+';"></label>')},genericLabel:function(){return a.generateLabel({hexColor:"FFFFFF",fontSize:"10px"})},registerEventForTool:function(a){var b=a.toolId,c=$(b),d=a.contextMenu,e=a.constantTitle;setupToolTips(c,e),a.tool=c,c.funcToggle("click",function(){activateTool(a),d.activate(d.getOptions())},function(){d.deactivate(d.getOptions()),deactivateTool(a)})}};$(function(){$("#image-button").on("change",function(a){var b=new FileReader;b.onload=function(a){var b=new Image;b.onload=function(){context.drawImage(b,0,0)},b.src=a.target.result},b.readAsDataURL(a.target.files[0])})}),$(function(){var b={CONSTANTS:{id:"MandelbrotFractalTool",selectionId:"#MandelbrotFractalTool","class":"main-tool",title:"Click to draw Mandelbrot Fractal. Click again to disable.",maxHeight:-1,maxWidth:-1},VARIABLES:{iterations:1e3,xMax:1,yMax:1,xMin:-2,yMin:-1,height:-1,width:-1},start:function(a){function c(a){function c(a,b,c){for(var d=0,e=0,f=0,g=0,h=0,i=c;i--&&4>=f+g;)h=d*e,f=d*d,g=e*e,d=f-g+a,e=h+h+b;return c-i}function d(a){var d,e,f,g,h,i,j,k=a.context,l=a.XMin,m=a.YMin,n=a.XMax,o=a.YMax,p=a.iterations,q=b.VARIABLES.width,r=b.VARIABLES.height,s=k.getImageData(0,0,q,r),t=s.data,u=Color.hexToRgb(selectedPrimaryColor);for(d=0;q>d;++d)for(e=0;r>e;++e)f=l+(n-l)*d/(q-1),g=m+(o-m)*e/(r-1),h=c(f,g,p),j=4*(q*e+d),h>p?(t[j]=u.r,t[j+1]=u.g,t[j+2]=u.b):(i=3*Math.log(h)/Math.log(p-1),1>i?(t[j]=255*i,t[j+1]=0,t[j+2]=0):2>i?(t[j]=255,t[j+1]=255*(i-1),t[j+2]=0):(t[j]=255,t[j+1]=255,t[j+2]=255*(i-2))),t[j+3]=255;k.putImageData(s,a.startX,a.startY)}d(a)}var d=a.event,e=a.canvasId,f=function(a){return a+Math.floor(b.VARIABLES.width)-b.CONSTANTS.maxWidth},g=function(a){var c=Actions.Mouse.getX(a),d=Math.max(c-Math.floor(b.VARIABLES.width/2),0),e=f(d);return e>0&&(d-=e),d},h=function(a){return a+Math.floor(b.VARIABLES.height)-b.CONSTANTS.maxHeight},i=function(a){var c=Actions.Mouse.getY(a),d=Math.max(c-Math.floor(b.VARIABLES.height/2),0),e=h(d);return e>0&&(d-=e),d};$(e).on(d,function(a){var d={event:a,relativeTo:$(e)},f=g(d),h=i(d);c({context:context,XMin:b.VARIABLES.xMin,XMax:b.VARIABLES.xMax,YMin:b.VARIABLES.yMin,YMax:b.VARIABLES.yMax,iterations:b.VARIABLES.iterations,startX:f,startY:h})})},stop:function(a){$(a.canvasId).off(a.event)},ContextMenu:{activate:function(c){function d(b,c,d,e){return a.generateSlider({id:b,min:c,max:d,step:1,title:e})}function e(c){function e(a){var c=d("mandelbrotIterations","10",a.maxIterationsAllowed,"Iterations for mandelbrot fractal generation. Beware! If higher values are used, it might crash your browser.").attr("value",b.VARIABLES.iterations).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){var c=$(this).val();c>a.maxIterationsAllowed&&confirm("Beware! It might crash your browser. Go back?","back","No, I want these many iterations. I know what I am doing!")&&(c=a.maxIterationsAllowed),b.VARIABLES.iterations=c});return c}var f=a.genericLabel().append(c.iterationLabel).append(e(c));return f}function f(c){function e(a){var c=d("mandelbrotHeight","100",b.CONSTANTS.maxHeight,"Height for mandelbrot fractal generation.").attr("value",b.CONSTANTS.maxHeight).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){var a=$(this).val();a>b.CONSTANTS.maxHeight&&(a=b.CONSTANTS.maxHeight),b.VARIABLES.height=a});return c}var f=a.genericLabel().append(c.heightLabel).append(e(c));return f}function g(c){function e(a){var c=d("mandelbrotWidth","100",b.CONSTANTS.maxWidth,"Width for mandelbrot fractal generation.").attr("value",b.CONSTANTS.maxWidth).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){var a=$(this).val();a>b.CONSTANTS.maxWidth&&(a=b.CONSTANTS.maxWidth),b.VARIABLES.width=a});return c}var f=a.genericLabel().append(c.widthLabel).append(e(c));return f}function h(c){function e(a){var c=d("mandelbrotXMax","0","3","XMax for mandelbrot fractal generation.").attr("value","1").attr("disabled","disabled").on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){b.VARIABLES.xMax=$(this).val()});return c}var f=a.genericLabel().append(c.xMaxLabel).append(e(c));return f}function i(c){function e(a){var c=d("mandelbrotYMax","0","3","YMax for mandelbrot fractal generation.").attr("value","1").attr("disabled","disabled").on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){b.VARIABLES.yMax=$(this).val()});return c}var f=a.genericLabel().append(c.yMaxLabel).append(e(c));return f}function j(c){function e(a){var c=d("mandelbrotXMin","-3","1","XMin for mandelbrot fractal generation.").attr("value","-2").attr("disabled","disabled").on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){b.VARIABLES.xMin=$(this).val()});return c}var f=a.genericLabel().append(c.xMinLabel).append(e(c));return f}function k(c){function e(a){var c=d("mandelbrotYMin","-2","1","YMin for mandelbrot fractal generation.").attr("value","-1").attr("disabled","disabled").on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){b.VARIABLES.yMin=$(this).val()});return c}var f=a.genericLabel().append(c.yMinLabel).append(e(c));return f}var l=$("<div></div>").attr("id",c.id).addClass("menu-item");l.append(e(c)),l.append(f(c)),l.append(g(c)),l.append(h(c)),l.append(i(c)),l.append(j(c)),l.append(k(c)),l.appendTo($(c.containerSelectionCriterion))},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"MandelbrotFractalContextMenu",containerSelectionCriterion:".contextual-tool-bar",maxIterationsAllowed:2e3,minIterationsAllowed:10,iterationLabel:"Iterations: ",maxHeightAllowed:b.VARIABLES.maxHeight,heightLabel:"Height: ",maxWidthAllowed:b.VARIABLES.maxWidth,widthLabel:"Width: ",xMaxLabel:"XMax: ",yMaxLabel:"YMax: ",xMinLabel:"XMin: ",yMinLabel:"YMin: "}}},Events:{register:function(a){var c=a.toolId,d=$(c),e=b.ContextMenu;setupToolTips(d,b.CONSTANTS.title),a.tool=d,d.funcToggle("click",function(){activateTool(a),b.VARIABLES.height=b.CONSTANTS.maxHeight=$(a.canvasId)[0].height,b.VARIABLES.width=b.CONSTANTS.maxWidth=$(a.canvasId)[0].width,e.activate(e.getOptions())},function(){e.deactivate(e.getOptions()),deactivateTool(a)})}}};b.Events.register({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:"#"+CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Mandelbrot fractal"})}),$(function(){var b={CONSTANTS:{id:"PencilTool",selectionId:"#PencilTool","class":"main-tool",title:"Click to draw free-hand lines. Click again to disable."},VARIABLES:{width:2,LastPoint:{X:-1,Y:-1}},start:function(a){var c=a.event,d="#"+a.canvasId,e=null,f=null,g=null,h=null,i=null,j={get:function(){return{X:b.VARIABLES.LastPoint.X,Y:b.VARIABLES.LastPoint.Y}},set:function(a,c){b.VARIABLES.LastPoint.X=a,b.VARIABLES.LastPoint.Y=c}};$(d).on(c,function(a){e={event:a,relativeTo:$(this)};var c=function(){f=Actions.Mouse.getX(e),g=Actions.Mouse.getY(e),h=b.VARIABLES.width,i=j.get(),-1!=i.X&&CANVASAPI.drawLineSegmentFromLastPoint({context:context,last:i,current:{X:f,Y:g},width:h}),j.set(f,g)};void 0!==a.buttons&&(1===a.buttons?c():(b.VARIABLES.LastPoint.X=-1,b.VARIABLES.LastPoint.Y=-1))})},stop:function(a){var b=a.event||CONSTANTS.Events.mousemove,c="#"+(a.canvasId||CONSTANTS.canvasId);$(c).off(b)},ContextMenu:{activate:function(c){function d(){return a.generateSlider({id:"widthPencil",min:1,max:200,step:1,title:"Width for pencil tool."})}function e(a){var c=$("<div></div>").attr("id",a.id).addClass("menu-item");d().attr("value",b.VARIABLES.width).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.width=$(this).val()}).appendTo(c);c.appendTo($(a.containerSelectionCriterion))}e(c)},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"PencilContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mousemove,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Pencil",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"pick-color",selectionId:"#pick-color","class":"string-menu-item",containerId:"PickColorTool",title:"Click to pick color under mouse pointer tip; picks until some other tool is selected. Click again to disable."},ContextMenu:{activate:function(){},deactivate:function(){},getOptions:function(){}},start:function(a){var b=a.event||CONSTANTS.Events.mouseclick,c="#"+(a.canvasId||CONSTANTS.canvasId),d=null,e=null,f=null,g=null,h=0,i=0,j=0,k=0;$(c).on(b,function(a){d={event:a,relativeTo:$(this)},e=Actions.Mouse.getX(d),f=Actions.Mouse.getY(d),g=context.getImageData(e-.5,f-.5,e+.5,f+.5).data,h=g[0],i=g[1],j=g[2],k=g[3],selectedPrimaryColor=context.fillStyle="rgba("+h+", "+i+", "+j+", "+k+")"})},stop:function(a){var b=a.event||CONSTANTS.Events.mouseclick,c="#"+(a.canvasId||CONSTANTS.canvasId);$(c).off(b)}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,containerId:b.CONSTANTS.containerId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Color picker",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"PivotedLinePatternTool",selectionId:"#PivotedLinePatternTool","class":"main-tool",title:"Click to draw amazing pattern. Click again to disable.",ACTIONS:{pivots:"pivots",Ydrops:"drops",godRays:"god-rays",Xextends:"extends"}},VARIABLES:{width:2,LastPoint:{X:-1,Y:-1}},start:function(a){var c=a.event||CONSTANTS.Events.mousemove,d="#"+(a.canvasId||CONSTANTS.canvasId),e=null,f=null,g=null,h=null,i=null,j={get:function(){return{X:b.VARIABLES.LastPoint.X,Y:b.VARIABLES.LastPoint.Y}},set:function(a,c){b.VARIABLES.LastPoint.X=a,b.VARIABLES.LastPoint.Y=c}},k=null;$(d).on(c,function(a){e={event:a,relativeTo:$(this)},f=Actions.Mouse.getX(e),g=Actions.Mouse.getY(e),k=$("[name=tool-options]:checked").val();var c=function(){h=b.VARIABLES.width,i=j.get(),-1!=i.X&&CANVASAPI.drawLineSegmentFromLastPoint({context:context,last:i,current:{X:f,Y:g},width:h}),k===b.CONSTANTS.ACTIONS.Xextends&&j.set(0,g),k===b.CONSTANTS.ACTIONS.Ydrops&&j.set(f,0),k===b.CONSTANTS.ACTIONS.godRays&&j.set(0,0)};void 0!==a.buttons&&(1===a.buttons?c():(j.set(-1,-1),k===b.CONSTANTS.ACTIONS.pivots&&j.set(f,g)))})},stop:function(a){var b=a.event||CONSTANTS.Events.mousemove,c="#"+(a.canvasId||CONSTANTS.canvasId);$(c).off(b)},ContextMenu:{activate:function(c){function d(){return a.generateSlider({id:"widthPivotedLinePattern",min:1,max:200,step:1,title:"width for pivoted line pattern tool."})}function e(a){d().attr("value",b.VARIABLES.width).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.width=$(this).val()}).appendTo(f);f.appendTo($(a.containerSelectionCriterion))}var f=$("<div></div>").attr("id",c.id).addClass("menu-item"),g=function(){var c=function(b,c,d){return a.genericLabel().append(d).append(' <input id="'+b+'" name="'+c+'" type="radio" value="'+d+'" /></label>')};f.append(c("option_pivot","tool-options",b.CONSTANTS.ACTIONS.pivots)),f.append(c("option_extends","tool-options",b.CONSTANTS.ACTIONS.Xextends)),f.append(c("option_drops","tool-options",b.CONSTANTS.ACTIONS.Ydrops)),f.append(c("option_god_rays","tool-options",b.CONSTANTS.ACTIONS.godRays))};e(c),g()},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"PivotedLinePatternContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mousemove,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Pivoted Line Pattern",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"PointWalkerTool",selectionId:"#PointWalkerTool","class":"main-tool",title:"Click to draw random point walker. Click again to disable."},VARIABLES:{steps:100},start:function(a){var c=a.event,d="#"+a.canvasId,e=null,f=null,g=null,h=0;$(d).on(c,function(a){for(e={event:a,relativeTo:$(d)},f=Actions.Mouse.getX(e),g=Actions.Mouse.getY(e),h=0;h<b.VARIABLES.steps;h++)CANVASAPI.fillCirc(f,g,1),f+=Math.random()<.5?-1:1,g-=Math.random()<.5?-1:1})},stop:function(a){$("#"+a.canvasId).off(a.event)},ContextMenu:{activate:function(c){function d(b,c,d,e){return a.generateSlider({id:b,min:c,max:d,step:1,title:e})}function e(c){function e(a){var c=d("pointWalkerSptes","500",a.maxStepsAllowed,"Steps for random point walk generation.").attr("value",b.VARIABLES.steps).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){b.VARIABLES.steps=$(this).val()});return c}return a.genericLabel().append(c.stepLabel).append(e(c))}var f=$("<div></div>").attr("id",c.id).addClass("menu-item");f.append(e(c)),f.appendTo($(c.containerSelectionCriterion))},deactivate:function(a){$("#"+a.id).remove()},getOptions:function(){return{tool:this,id:"PointWalkerContextMenu",containerSelectionCriterion:".contextual-tool-bar",maxStepsAllowed:1e5,stepLabel:"Steps: "}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Point Walker",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"RectangleTool",selectionId:"#RectangleTool","class":"main-tool",title:"Click to draw rectangles. Click again to disable.",previewId:"previewRectangle"},VARIABLES:{length:20,breadth:10,xyPlaneRotationAngle:360},start:function(a){function c(a){$("<div></div>").attr("id",b.CONSTANTS.previewId).css({position:"fixed","z-index":"2"}).appendTo(".utilities").on("click",function(a){var c={event:a,relativeTo:$(d)},e=Actions.Mouse.getX(c),f=Actions.Mouse.getY(c),g=b.VARIABLES.length,h=b.VARIABLES.breadth;l=b.VARIABLES.xyPlaneRotationAngle*Math.PI/180,CANVASAPI.fillRotatedRectangle(e-g/2,f-h/2,g,h,l)}).on("mousemove",function(a){$(this).css("top",a.pageY-b.VARIABLES.breadth/2-window.scrollY).css("left",a.pageX-b.VARIABLES.length/2-window.scrollX).css("background-color",selectedPrimaryColor).css("border","thin dashed "+selectedAlternativeColor).css("height",b.VARIABLES.breadth).css("width",b.VARIABLES.length),j=$(this).offset().left+b.VARIABLES.length/2,k=$(this).offset().top+b.VARIABLES.breadth/2,f=$(d).offset().left,g=$(d).offset().top,(f>j||j>f+i||g>k||k>g+h)&&$(this).hide()})}var d=(a.event,"#"+a.canvasId),e=null,f=$(d).offset().left,g=$(d).offset().top,h=$(d).height(),i=$(d).width(),j=null,k=null,l=null;c(),$(d).on("mousemove",function(a){e=e||$("#"+b.CONSTANTS.previewId),e.css("top",a.pageY-b.VARIABLES.breadth/2-window.scrollY).css("left",a.pageX-b.VARIABLES.length/2-window.scrollX).css("background-color",selectedPrimaryColor).css("height",b.VARIABLES.breadth).css("width",b.VARIABLES.length).css("transform","rotate("+parseInt(b.VARIABLES.xyPlaneRotationAngle*Math.PI)/180+"rad)").show()})},stop:function(a){var c=a.event||CONSTANTS.Events.mouseclick,d="#"+(a.canvasId||CONSTANTS.canvasId);$(d).off(c),$("#"+b.CONSTANTS.previewId).off("mousemove"),$("#"+b.CONSTANTS.previewId).remove()},ContextMenu:{activate:function(c){function d(b,c,d,e){return a.generateSlider({id:b,min:e,max:d,step:1,title:c})}function e(a){return d("xyPlaneRotationAngle","rotation angle for XY plane rotation.",360,0).attr("value",b.VARIABLES.xyPlaneRotationAngle).on("mouseover",function(){$(this).attr("title",$(this).val()+" deg")}).on("input",function(){b.VARIABLES.xyPlaneRotationAngle=$(this).val()})}function f(a){d(a.lengthId,a.lengthTitle,400,10).attr("value",b.VARIABLES.length).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.length=$(this).val()}).appendTo(g),d(a.breadthId,a.breadthTitle,400,10).attr("value",b.VARIABLES.breadth).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.breadth=$(this).val()}).appendTo(g)}var g=$("<div></div>").attr("id",c.id).addClass("menu-item");f(c),g.append(e(c)),g.appendTo($(c.containerSelectionCriterion))},deactivate:function(a){function c(a){$("#"+a.lengthId).remove(),$("#"+a.breadthId).remove(),$("#xyPlaneRotationAngle").remove()}c(a),$("#"+b.CONSTANTS.previewId).off("mousemove"),$("#"+b.CONSTANTS.previewId).remove()},getOptions:function(){return{tool:this,id:"RectangleContextMenu",lengthId:"lengthRectangle",breadthId:"breadthRectangle",lengthTitle:"length for rectangle",breadthTitle:"breadth for rectangle",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Rectangle",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"RingTool",selectionId:"#RingTool","class":"main-tool",title:"Click to draw ring. Click again to disable.",previewId:"previewRing",previewOuterId:"previewOuterRing"},VARIABLES:{innerRadius:10,outerRadius:20},start:function(a){function c(a){var c=$("<div></div>").attr("id",b.CONSTANTS.previewOuterId).css({position:"fixed","z-index":"2","border-radius":"50%",height:2*b.VARIABLES.outerRadius,width:2*b.VARIABLES.outerRadius,"backgruond-color":selectedPrimaryColor}).appendTo(".utilities");$("<div></div>").attr("id",b.CONSTANTS.previewId).css({position:"fixed","z-index":"2","border-radius":"50%"}).appendTo(c).on("click",function(a){e={event:a,relativeTo:$(d)},f=Actions.Mouse.getX(e),g=Actions.Mouse.getY(e),h=b.VARIABLES.innerRadius,i=b.VARIABLES.outerRadius,CANVASAPI.fillRing({X:f,Y:g,innerRadius:h,outerRadius:i,strokeColor:selectedPrimaryColor,fillColor:selectedAlternativeColor})}).on("mousemove",function(a){$(this).css("top",a.pageY-parseInt(b.VARIABLES.innerRadius)-parseInt(window.scrollY)).css("left",a.pageX-parseInt(b.VARIABLES.innerRadius)-parseInt(window.scrollX)).css("background-color",selectedAlternativeColor).css("border","thin dashed "+selectedPrimaryColor).css("height",2*b.VARIABLES.innerRadius).css("width",2*b.VARIABLES.innerRadius),q.css({position:"fixed",top:a.pageY-parseInt(b.VARIABLES.outerRadius)-parseInt(window.scrollY),left:a.pageX-parseInt(b.VARIABLES.outerRadius)-parseInt(window.scrollX),"z-index":"2","border-radius":"50%",height:2*b.VARIABLES.outerRadius,width:2*b.VARIABLES.outerRadius,"background-color":selectedPrimaryColor}),o=$(this).offset().left+parseInt(b.VARIABLES.innerRadius),p=$(this).offset().top+parseInt(b.VARIABLES.innerRadius),k=$(d).offset().left,l=$(d).offset().top,(k>o||parseInt(k)+parseInt(n)<o||l>p||parseInt(l)+parseInt(m)<p)&&($(this).hide(),q.hide())})}var d=(a.event||CONSTANTS.Events.mouseclick,"#"+(a.canvasId||CONSTANTS.canvasId)),e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=$(d).height(),n=$(d).width(),o=null,p=null,q=null;c(),$(d).on("mousemove",function(a){j=j||$("#"+b.CONSTANTS.previewId),j.css("top",a.pageY-parseInt(b.VARIABLES.innerRadius)-parseInt(window.scrollY)).css("left",a.pageX-parseInt(b.VARIABLES.innerRadius)-parseInt(window.scrollX)).css("background-color",selectedAlternativeColor).css("height",2*b.VARIABLES.innerRadius).css("width",2*b.VARIABLES.innerRadius).show(),q=q||$("#"+b.CONSTANTS.previewOuterId),q.css({position:"fixed",top:a.pageY-parseInt(b.VARIABLES.outerRadius)-parseInt(window.scrollY),left:a.pageX-parseInt(b.VARIABLES.outerRadius)-parseInt(window.scrollX),"z-index":"2","border-radius":"50%",height:2*b.VARIABLES.outerRadius,width:2*b.VARIABLES.outerRadius,"background-color":selectedPrimaryColor}).show()})},stop:function(a){var c=a.event||CONSTANTS.Events.mouseclick,d="#"+(a.canvasId||CONSTANTS.canvasId);$(d).off(c),$("#"+b.CONSTANTS.previewId).off("mousemove"),$("#"+b.CONSTANTS.previewId).remove(),$("#"+b.CONSTANTS.previewOuterId).remove()},ContextMenu:{activate:function(c){function d(b,c){return a.generateSlider({id:b,min:1,max:200,step:1,title:c})}function e(a){var c=$("<div></div>").attr("id",a.id).addClass("menu-item");d("innerRadiusRing","inner radius for ring tool.").attr("value",b.VARIABLES.innerRadius).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.innerRadius=$(this).val()}).appendTo(c),d("outerRadiusRing","outer radius for ring tool.").attr("value",b.VARIABLES.outerRadius).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.outerRadius=$(this).val()}).appendTo(c);c.appendTo($(a.containerSelectionCriterion))}e(c)},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"RingContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Ring",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"SpeedCircleTool",selectionId:"#SpeedCircleTool","class":"main-tool",title:"Click to draw Circles. Click again to disable."},VARIABLES:{radius:4},start:function(a){var c=a.event,d="#"+a.canvasId,e=null,f=null,g=null,h=null;$(d).on(c,function(a){e={event:a,relativeTo:$(this)},f=Actions.Mouse.getX(e),g=Actions.Mouse.getY(e),h=b.VARIABLES.radius,CANVASAPI.drawCircle({X:f,Y:g,innerRadius:h,outerRadius:parseInt(h)+1,strokeColor:selectedPrimaryColor})})},stop:function(a){$("#"+a.canvasId).off(a.event)},ContextMenu:{activate:function(c){function d(){return a.generateSlider({id:"radiusSpeedCircle",min:1,max:200,step:1,title:"radius for speed circle tool"})}function e(a){var b=$("<div></div>").attr("id",a.id).addClass("menu-item");d().attr("value",f.radius).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){f.radius=$(this).val()}).appendTo(b);b.appendTo($(a.containerSelectionCriterion))}var f=b.VARIABLES;e(c)},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"SpeedCircleContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mousemove,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Speed circle",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"SpeedDiscTool",selectionId:"#SpeedDiscTool","class":"main-tool",title:"Click to draw Discs. Click again to disable."},VARIABLES:{radius:4},start:function(a){var c=a.event,d="#"+a.canvasId,e=null,f=null,g=null,h=null;$(d).on(c,function(a){e={event:a,relativeTo:$(this)},f=Actions.Mouse.getX(e),g=Actions.Mouse.getY(e),h=b.VARIABLES.radius,CANVASAPI.fillCirc(f,g,h)})},stop:function(a){$("#"+a.canvasId).off(a.event)},ContextMenu:{activate:function(c){function d(){return a.generateSlider({id:"radiusSpeedDisc",min:1,max:200,step:1,title:"radius for speed disc tool"})}function e(a){var b=$("<div></div>").attr("id",a.id).addClass("menu-item");d().attr("value",f.radius).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){f.radius=$(this).val()}).appendTo(b);b.appendTo($(a.containerSelectionCriterion))}var f=b.VARIABLES;e(c)},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"SpeedDiscContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mousemove,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Speed disc",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"SpeedDotTool",selectionId:"#SpeedDotTool","class":"main-tool",title:"Click to draw dots. Click again to disable."},VARIABLES:{},ContextMenu:{activate:function(a){},getOptions:function(){},deactivate:function(){}},start:function(a){var b=a.event,c="#"+a.canvasId,d=null,e=null,f=null;$(c).on(b,function(a){d={event:a,relativeTo:$(this)},e=Actions.Mouse.getX(d),f=Actions.Mouse.getY(d),CANVASAPI.fillCirc(e,f,1)})},stop:function(a){$("#"+a.canvasId).off(a.event)},Events:{register:function(a){var c=a.toolId,d=$(c);setupToolTips(d,b.CONSTANTS.title),a.tool=d,d.funcToggle("click",function(){activateTool(a)},function(){deactivateTool(a)})}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mousemove,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Speed dot",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"SpeedPencilTool",selectionId:"#SpeedPencilTool","class":"main-tool",title:"Click to draw draw free hand lines. Click again to disable."},VARIABLES:{width:2,LastPoint:{X:-1,Y:-1}},start:function(a){function c(a){var b=a.context,c=a.last,d=a.current,e=a.width;b.beginPath(),b.moveTo(c.X,c.Y),b.lineTo(d.X,d.Y),b.lineWidth=e,b.strokeStyle=selectedPrimaryColor,b.stroke()}var d=a.event,e="#"+a.canvasId,f=null,g=null,h=null,i=null,j=null,k={get:function(){return{X:b.VARIABLES.LastPoint.X,Y:b.VARIABLES.LastPoint.Y}},set:function(a,c){b.VARIABLES.LastPoint.X=a,b.VARIABLES.LastPoint.Y=c}};$(e).on(d,function(a){f={event:a,relativeTo:$(this)},g=Actions.Mouse.getX(f),h=Actions.Mouse.getY(f),i=b.VARIABLES.width,j=k.get(),-1!=j.X&&c({context:context,last:j,current:{X:g,Y:h},width:i}),CANVASAPI.fillCirc(g,h,i/2),k.set(g,h)})},stop:function(a){b.VARIABLES.LastPoint.X=-1,b.VARIABLES.LastPoint.Y=-1,$("#"+a.canvasId).off(a.event)},ContextMenu:{activate:function(c){function d(){return a.generateSlider({id:"widthSpeedPencil",min:1,max:200,step:1,title:"width for speed pencil tool."})}function e(a){var c=$("<div></div>").attr("id",a.id).addClass("menu-item");d().attr("value",b.VARIABLES.width).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.width=$(this).val()}).appendTo(c);c.appendTo($(a.containerSelectionCriterion))}e(c)},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"SpeedPencilContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mousemove,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Speed pencil",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"SpeedRectangleTool",selectionId:"#SpeedRectangleTool","class":"main-tool",title:"Click to draw speed rectangles. Click again to disable."},VARIABLES:{length:20,breadth:10},start:function(a){var c=(a.event,"#"+a.canvasId);$(c).on("mousemove",function(a){var d={event:a,relativeTo:$(c)},e=Actions.Mouse.getX(d),f=Actions.Mouse.getY(d),g=b.VARIABLES.length,h=b.VARIABLES.breadth;context.fillRect(e-g/2,f-h/2,g,h)})},stop:function(a){$("#"+a.canvasId).off(a.event)},ContextMenu:{activate:function(c){function d(b,c){return a.generateSlider({id:b,min:1,max:200,step:1,title:c})}function e(a){var c=$("<div></div>").attr("id",a.id).addClass("menu-item");d(a.lengthId,a.lengthTitle).attr("value",b.VARIABLES.length).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.length=$(this).val()}).appendTo(c),d(a.breadthId,a.breadthTitle).attr("value",b.VARIABLES.breadth).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.breadth=$(this).val()}).appendTo(c);c.appendTo($(a.containerSelectionCriterion))}e(c)},deactivate:function(a){function c(a){$("#"+a.lengthId).remove(),$("#"+a.breadthId).remove()}c(a),$("#"+b.CONSTANTS.previewId).off("mousemove"),$("#"+b.CONSTANTS.previewId).remove()},getOptions:function(){return{tool:this,id:"SpeedRectangleContextMenu",lengthId:"lengthSpeedRectangle",breadthId:"breadthSpeedRectangle",lengthTitle:"length for speed rectangle",breadthTitle:"breadth for speed rectangle",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mousemove,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Speed rectangle",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"SpeedRingTool",selectionId:"#SpeedRingTool","class":"main-tool",title:"Click to draw speed rings. Click again to disable."},VARIABLES:{innerRadius:10,outerRadius:20},start:function(a){var c=a.event,d="#"+a.canvasId,e=null,f=null,g=null,h=null,i=null;$(d).on(c,function(a){e={event:a,relativeTo:$(this)},f=Actions.Mouse.getX(e),g=Actions.Mouse.getY(e),h=b.VARIABLES.innerRadius,i=b.VARIABLES.outerRadius,CANVASAPI.fillRing({X:f,Y:g,innerRadius:h,outerRadius:i,strokeColor:selectedPrimaryColor,fillColor:selectedAlternativeColor})})},stop:function(a){$("#"+a.canvasId).off(a.event)},ContextMenu:{activate:function(c){function d(b,c){return a.generateSlider({id:b,min:1,max:200,step:1,title:c})}function e(a){var c=$("<div></div>").attr("id",a.id).addClass("menu-item");d("innerRadiusSpeedRing","inner radius for speed ring tool.").attr("value",b.VARIABLES.innerRadius).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.innerRadius=$(this).val()}).appendTo(c),d("outerRadiusSpeedRing","outer radius for speed ring tool.").attr("value",b.VARIABLES.outerRadius).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.outerRadius=$(this).val()}).appendTo(c);c.appendTo($(a.containerSelectionCriterion))}e(c)},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"SpeedRingContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mousemove,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Speed ring",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"SpeedSquareTool",selectionId:"#SpeedSquareTool","class":"main-tool",title:"Click to draw speed squares. Click again to disable."},VARIABLES:{side:10,xyPlaneRotationAngle:360},start:function(a){var c=(a.event,"#"+a.canvasId);$(c).on("mousemove",function(a){var d={event:a,relativeTo:$(c)},e=Actions.Mouse.getX(d),f=Actions.Mouse.getY(d),g=b.VARIABLES.side,h=b.VARIABLES.xyPlaneRotationAngle*Math.PI/180;CANVASAPI.fillRoatedSquare(e-g/2,f-g/2,g,h)})},stop:function(a){$("#"+a.canvasId).off(a.event)},ContextMenu:{activate:function(c){function d(b,c,d){return a.generateSlider({id:b,min:10,max:d,step:1,title:c})}function e(a){var b=$("#"+a.id);return 0===b.length?$("<div></div>").attr("id",a.id).addClass("menu-item"):b}function f(c){function e(a){return d("sideSpeedSquare","side length for square tool",200).attr("value",b.VARIABLES.side).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.side=$(this).val()})}return a.genericLabel().append(c.sideLabel).append(e(c))}function g(c){function e(a){return d("xyPlaneRotationAngle","rotation angle for XY plane rotation.",360).attr("value",b.VARIABLES.xyPlaneRotationAngle).on("mouseover",function(){$(this).attr("title",$(this).val()+" deg")}).on("input",function(){b.VARIABLES.xyPlaneRotationAngle=$(this).val()})}return a.genericLabel().append(c.xyPlaneRotationAngle).append(e(c))}var h=e(c);f(c).appendTo(h),g(c).appendTo(h),h.appendTo($(c.containerSelectionCriterion))},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"SpeedSquareToolContextMenu",containerSelectionCriterion:".contextual-tool-bar",xyPlaneRotationAngle:"xy plane rotation angle: ",sideLabel:"side length: "}}
}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mousemove,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Speed square",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"SquareTool",selectionId:"#SquareTool","class":"main-tool",title:"Click to draw squares. Click again to disable.",previewId:"previewSquare"},VARIABLES:{side:10,xyPlaneRotationAngle:360},start:function(a){function c(a){$("<div></div>").attr("id",b.CONSTANTS.previewId).css({position:"fixed","z-index":"2"}).appendTo(".utilities").on("click",function(a){var c={event:a,relativeTo:$(d)},e=Actions.Mouse.getX(c),f=Actions.Mouse.getY(c),g=b.VARIABLES.side,h=b.VARIABLES.xyPlaneRotationAngle*Math.PI/180;CANVASAPI.fillRoatedSquare(e-g/2,f-g/2,g,h)}).on("mousemove",function(a){$(this).css("top",parseInt(a.pageY)-parseInt(b.VARIABLES.side/2)-parseInt(window.scrollY)).css("left",parseInt(a.pageX)-parseInt(parseInt(b.VARIABLES.side/2))-parseInt(window.scrollX)).css("background-color",selectedPrimaryColor).css("border","thin dashed "+selectedAlternativeColor).css("height",b.VARIABLES.side).css("width",b.VARIABLES.side),j=parseInt($(this).offset().left)+parseInt(b.VARIABLES.side/2),k=parseInt($(this).offset().top)+parseInt(b.VARIABLES.side/2),f=$(d).offset().left,g=$(d).offset().top,(f>j||parseInt(f+i)<j||g>k||parseInt(g+h)<k)&&$(this).hide()})}var d=(a.event||CONSTANTS.Events.mouseclick,"#"+(a.canvasId||CONSTANTS.canvasId)),e=null,f=$(d).offset().left,g=$(d).offset().top,h=$(d).height(),i=$(d).width(),j=null,k=null;c(),$(d).on("mousemove",function(a){e=e||$("#"+b.CONSTANTS.previewId),e.css("top",a.pageY-parseInt(b.VARIABLES.side/2)-window.scrollY).css("left",a.pageX-parseInt(b.VARIABLES.side/2)-window.scrollX).css("background-color",selectedPrimaryColor).css("height",b.VARIABLES.side).css("width",b.VARIABLES.side).css("transform","rotate("+parseInt(b.VARIABLES.xyPlaneRotationAngle*Math.PI)/180+"rad)").show()})},stop:function(a){var b=a.event||CONSTANTS.Events.mouseclick,c="#"+(a.canvasId||CONSTANTS.canvasId);$(c).off(b)},ContextMenu:{activate:function(c){function d(b,c,d,e){return a.generateSlider({id:b,min:e,max:d,step:1,title:c})}function e(a){var b=$("#"+a.id);return 0===b.length?$("<div></div>").attr("id",a.id).addClass("menu-item"):b}function f(a){return d("sideSquare","side length for square tool",200,10).attr("value",b.VARIABLES.side).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.side=$(this).val()})}function g(a){return d("xyPlaneRotationAngle","rotation angle for XY plane rotation.",360,0).attr("value",b.VARIABLES.xyPlaneRotationAngle).on("mouseover",function(){$(this).attr("title",$(this).val()+" deg")}).on("input",function(){b.VARIABLES.xyPlaneRotationAngle=$(this).val()})}var h=e(c);f(c).appendTo(h),g(c).appendTo(h),h.appendTo($(c.containerSelectionCriterion))},deactivate:function(a){function c(a){$("#"+a.id).remove()}c(a),$("#"+b.CONSTANTS.previewId).off("mousemove"),$("#"+b.CONSTANTS.previewId).remove()},getOptions:function(){return{tool:this,id:"SquareToolContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Square",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"CircleTool",selectionId:"#CircleTool","class":"main-tool",title:"Click to draw circle. Click again to disable.",previewId:"previewCircle"},VARIABLES:{innerRadius:10},start:function(a){function c(a){$("<div></div>").attr("id",b.CONSTANTS.previewId).css({position:"fixed","z-index":"2","border-radius":"50%"}).appendTo(".utilities").on("click",function(a){e={event:a,relativeTo:$(d)},f=Actions.Mouse.getX(e),g=Actions.Mouse.getY(e),h=b.VARIABLES.innerRadius,i=parseInt(b.VARIABLES.innerRadius)+1,CANVASAPI.drawCircle({X:f,Y:g,innerRadius:h,outerRadius:i,strokeColor:selectedPrimaryColor})}).on("mousemove",function(a){$(this).css("top",a.pageY-b.VARIABLES.innerRadius-window.scrollY).css("left",a.pageX-b.VARIABLES.innerRadius-window.scrollX).css("border","thin solid "+selectedPrimaryColor).css("height",2*b.VARIABLES.innerRadius).css("width",2*b.VARIABLES.innerRadius),o=parseInt($(this).offset().left)+parseInt(b.VARIABLES.innerRadius),p=parseInt($(this).offset().top)+parseInt(b.VARIABLES.innerRadius),k=$(d).offset().left,l=$(d).offset().top,(k>o||parseInt(k)+parseInt(n)<o||l>p||parseInt(l)+parseInt(m)<p)&&$(this).hide()})}var d=(a.event||CONSTANTS.Events.mouseclick,"#"+(a.canvasId||CONSTANTS.canvasId)),e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=null,m=$(d).height(),n=$(d).width(),o=null,p=null;c(),$(d).on("mousemove",function(a){j=j||$("#"+b.CONSTANTS.previewId),j.css("top",a.pageY-b.VARIABLES.innerRadius-window.scrollY).css("left",a.pageX-b.VARIABLES.innerRadius-window.scrollX).css("border","thin solid "+selectedPrimaryColor).css("height",2*b.VARIABLES.innerRadius).css("width",2*b.VARIABLES.innerRadius).show()})},stop:function(a){var c=a.event||CONSTANTS.Events.mouseclick,d="#"+(a.canvasId||CONSTANTS.canvasId);$(d).off(c),$("#"+b.CONSTANTS.previewId).off("mousemove"),$("#"+b.CONSTANTS.previewId).remove()},ContextMenu:{activate:function(c){function d(b,c){return a.generateSlider({id:b,min:1,max:200,step:1,title:c})}function e(a){var c=$("<div></div>").attr("id",a.id).addClass("menu-item"),e=d("radiusCircle","innerRadius for circle tool.").attr("value",b.VARIABLES.innerRadius).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.innerRadius=$(this).val()});e.appendTo(c),c.appendTo($(a.containerSelectionCriterion))}e(c)},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"CircleContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Circle",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})}),$(function(){var b={CONSTANTS:{id:"DiscTool",selectionId:"#DiscTool","class":"main-tool",title:"Click to draw disc. Click again to disable.",previewId:"previewDisc"},VARIABLES:{radius:10},start:function(a){function c(a){$("<div></div>").attr("id",b.CONSTANTS.previewId).css({position:"fixed","z-index":"2","border-radius":"50%"}).appendTo(".utilities").on("click",function(a){e={event:a,relativeTo:$(d)},f=Actions.Mouse.getX(e),g=Actions.Mouse.getY(e),h=b.VARIABLES.radius,CANVASAPI.fillCirc(f,g,h)}).on("mousemove",function(a){$(this).css("top",a.pageY-b.VARIABLES.radius-window.scrollY).css("left",a.pageX-b.VARIABLES.radius-window.scrollX).css("background-color",selectedPrimaryColor).css("border","thin dashed "+selectedAlternativeColor).css("height",2*b.VARIABLES.radius).css("width",2*b.VARIABLES.radius),n=parseInt($(this).offset().left)+parseInt(b.VARIABLES.radius),o=parseInt($(this).offset().top)+parseInt(b.VARIABLES.radius),j=$(d).offset().left,k=$(d).offset().top,(j>n||parseInt(j)+parseInt(m)<n||k>o||parseInt(k)+parseInt(l)<o)&&$(this).hide()})}var d=(a.event||CONSTANTS.Events.mouseclick,"#"+(a.canvasId||CONSTANTS.canvasId)),e=null,f=null,g=null,h=null,i=null,j=$(d).offset().left,k=$(d).offset().top,l=$(d).height(),m=$(d).width(),n=null,o=null;c(),$(d).on("mousemove",function(a){i=i||$("#"+b.CONSTANTS.previewId),i.css("top",a.pageY-b.VARIABLES.radius-window.scrollY).css("left",a.pageX-b.VARIABLES.radius-window.scrollX).css("background-color",selectedPrimaryColor).css("height",2*b.VARIABLES.radius).css("width",2*b.VARIABLES.radius).show()})},stop:function(a){var c=a.event||CONSTANTS.Events.mouseclick,d="#"+(a.canvasId||CONSTANTS.canvasId);$(d).off(c),$("#"+b.CONSTANTS.previewId).off("mousemove"),$("#"+b.CONSTANTS.previewId).remove()},ContextMenu:{activate:function(c){function d(){return a.generateSlider({id:"radiusDisc",min:1,max:200,step:1,title:"radius for disc tool."})}function e(a){var c=$("<div></div>").attr("id",a.id).addClass("menu-item");d().attr("value",b.VARIABLES.radius).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){b.VARIABLES.radius=$(this).val()}).appendTo(c);c.appendTo($(a.containerSelectionCriterion))}e(c)},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"DiscContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Disc",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title})});var b={CONSTANTS:{id:"FamilyPointWalkerTool",selectionId:"#FamilyPointWalkerTool","class":"main-tool",title:"Click to draw family random point walker. Click again to disable."},VARIABLES:{steps:100,durationBetweenDanceStepsInMiliSeconds:100},start:function(a){var c,d,e=a.event,f="#"+a.canvasId,g=null,h=null,i=null,j=0,k=[],l={};$(f).on(e,function(a){function e(a){for(h=a.X,i=a.Y,c=a.steps,d=a.fillColor,j=0;c>j;j++)k[j]={X:h,Y:i},context.fillStyle=d,CANVASAPI.fillCirc(h,i,1),h+=Math.random()<.5?-1:1,i-=Math.random()<.5?-1:1;setTimeout(function(){e(a)},1e3)}g={event:a,relativeTo:$(f)},h=Actions.Mouse.getX(g),i=Actions.Mouse.getY(g),l={X:h,Y:i,steps:b.VARIABLES.steps,fillColor:selectedPrimaryColor},setTimeout(function(){e(l)},1e3)})},stop:function(a){$("#"+a.canvasId).off(a.event)},ContextMenu:{activate:function(c){function d(b,c,d,e){return a.generateSlider({id:b,min:c,max:d,step:1,title:e})}function e(c){function e(a){var c=d("familyPointWalkerSptes",b.VARIABLES.steps,a.maxStepsAllowed,"Steps for family random point walk generation.").attr("value",b.VARIABLES.steps).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){b.VARIABLES.steps=$(this).val()});return c}return a.genericLabel().append(c.stepLabel).append(e(c))}var f=$("<div></div>").attr("id",c.id).addClass("menu-item");f.append(e(c)),f.appendTo($(c.containerSelectionCriterion))},deactivate:function(a){$("#"+a.id).remove()},getOptions:function(){return{tool:this,id:"FamilyPointWalkerContextMenu",containerSelectionCriterion:".contextual-tool-bar",maxStepsAllowed:1e5,stepLabel:"Steps: "}}}};a.registerEventForTool({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Family Point Walker",contextMenu:b.ContextMenu,constantTitle:b.CONSTANTS.title});var c={CONSTANTS:{id:"OrganismPointWalkerTool",selectionId:"#OrganismPointWalkerTool","class":"main-tool",title:"Click to draw organism random point walker. Click again to disable."},VARIABLES:{steps:100,durationBetweenDanceStepsInMiliSeconds:100},start:function(a){var b,d,e=a.event,f="#"+a.canvasId,g=null,h=null,i=null,j=0,k=[],l={};$(f).on(e,function(a){function e(a){for(h=a.X,i=a.Y,b=a.steps,d=a.fillColor,j=0;b>j;j++)k[j]={X:h,Y:i},context.fillStyle=d,CANVASAPI.fillCirc(h,i,1),h+=Math.random()<.5?-1:1,i-=Math.random()<.5?-1:1;a.X=h,a.Y=i,setTimeout(function(){e(a)},1e3)}g={event:a,relativeTo:$(f)},h=Actions.Mouse.getX(g),i=Actions.Mouse.getY(g),l={X:h,Y:i,steps:c.VARIABLES.steps,fillColor:selectedPrimaryColor},setTimeout(function(){e(l)},1e3)})},stop:function(a){$("#"+a.canvasId).off(a.event)},ContextMenu:{activate:function(b){function d(b,c,d,e){return a.generateSlider({id:b,min:c,max:d,step:1,title:e})}function e(b){function e(a){var b=d("organismPointWalkerSptes",c.VARIABLES.steps,a.maxStepsAllowed,"Steps for organism random point walk generation.").attr("value",c.VARIABLES.steps).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){c.VARIABLES.steps=$(this).val()});return b}return a.genericLabel().append(b.stepLabel).append(e(b))}var f=$("<div></div>").attr("id",b.id).addClass("menu-item");f.append(e(b)),f.appendTo($(b.containerSelectionCriterion))},deactivate:function(a){$("#"+a.id).remove()},getOptions:function(){return{tool:this,id:"OrganismPointWalkerContextMenu",containerSelectionCriterion:".contextual-tool-bar",maxStepsAllowed:1e4,stepLabel:"Steps: "}}}};a.registerEventForTool({toolId:c.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:c.start,stop:c.stop,toolName:"Organism Point Walker",contextMenu:c.ContextMenu,constantTitle:c.CONSTANTS.title})});