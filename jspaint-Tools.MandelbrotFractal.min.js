/*! jspaint 2015-07-12 Anubhav Saini (c) 2015 */
$(function(){"use strict";var a={CONSTANTS:{id:"MandelbrotFractalTool",selectionId:"#MandelbrotFractalTool","class":"main-tool",title:"Click to draw Mandelbrot Fractal. Click again to disable."},VARIABLES:{iterations:1e3,xMax:1,yMax:1,xMin:-2,yMin:-1},start:function(b){function c(a){function b(a,b,c){for(var d=0,e=0,f=0,g=0,h=0,i=c;i--&&4>=f+g;)h=d*e,f=d*d,g=e*e,d=f-g+a,e=h+h+b;return c-i}function c(a){var c,d,e,h,i,j,k,l=a.context,m=a.XMin,n=a.YMin,o=a.XMax,p=a.YMax,q=a.iterations,r=l.getImageData(0,0,f,g),s=r.data,t=Color.hexToRgb(selectedPrimaryColor);for(c=0;f>c;++c)for(d=0;g>d;++d)e=m+(o-m)*c/(f-1),h=n+(p-n)*d/(g-1),i=b(e,h,q),k=4*(f*d+c),i>q?(s[k]=t.r,s[k+1]=t.g,s[k+2]=t.b):(j=3*Math.log(i)/Math.log(q-1),1>j?(s[k]=255*j,s[k+1]=0,s[k+2]=0):2>j?(s[k]=255,s[k+1]=255*(j-1),s[k+2]=0):(s[k]=255,s[k+1]=255,s[k+2]=255*(j-2))),s[k+3]=255;l.putImageData(r,0,0)}c(a)}var d=b.event,e="#"+b.canvasId,f=$(e).width(),g=$(e).height(),h=a.VARIABLES.xMin,i=a.VARIABLES.xMax,j=a.VARIABLES.yMin,k=a.VARIABLES.yMax;$(e).on(d,function(){c({context:context,XMin:h,XMax:i,YMin:j,YMax:k,iterations:a.VARIABLES.iterations})})},stop:function(a){var b=a.event,c="#"+a.canvasId;$(c).off(b)},ContextMenu:{activate:function(b){function c(a,b,c,d){return $('<input id="'+a+'" type="range" min="'+b+'" max="'+c+'" step="1" title="'+d+'" />')}function d(b){function d(b){var d=c("mandelbrotIterations","10",b.maxIterationsAllowed,"Iterations for mandelbrot fractal generation. Beware! If higher values are used, it might crash your browser.").attr("value",a.VARIABLES.iterations).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){var c=$(this).val();return c>b.maxIterationsAllowed&&confirm("Beware! It might crash your browser. Go back?","back","No, I want these many iterations")?void(a.VARIABLES.iterations=b.maxIterationsAllowed):void(a.VARIABLES.iterations=c)});return d}return $('<label style="color: #FFFFFF; font-size: 10px;"></label>').append(b.iterationLabel).append(d(b))}var e=$("<div></div>").attr("id",b.id).addClass("menu-item");e.append(d(b)),e.appendTo($(b.containerSelectionCriterion))},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"MandelbrotFractalContextMenu",containerSelectionCriterion:".contextual-tool-bar",maxIterationsAllowed:2e3,minIterationsAllowed:10,iterationLabel:"Iterations: "}}},Events:{register:function(b){var c=b.toolId||a.CONSTANTS.selectionId,d=$(c),e=a.ContextMenu;setupToolTips(d,a.CONSTANTS.title),b.tool=d,d.funcToggle("click",function(){activateTool(b),e.activate(e.getOptions()),activeTool=$(this)},function(){activeTool=null,e.deactivate(e.getOptions()),deactivateTool(b)})}}};a.Events.register({toolId:a.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:a.start,stop:a.stop})});