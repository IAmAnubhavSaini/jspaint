/*! jspaint 2015-07-02 Anubhav Saini (c) 2015 */
!function(a){"use strict";a(function(){var b={canvasId:"jspaint-canvas",containerId:"jspaint-paint-area",activeToolCursorClass:"working-with-tools",maintoolsClass:"main-tool",basicColors:[{id:"00FFFF",name:"Aqua"},{id:"000000",name:"Black"},{id:"0000FF",name:"Blue"},{id:"FF00FF",name:"Fuchsia"},{id:"808080",name:"Gray"},{id:"008000",name:"Green"},{id:"00FF00",name:"Lime"},{id:"800000",name:"Maroon"},{id:"000080",name:"Navy"},{id:"808000",name:"Olive"},{id:"800080",name:"Purple"},{id:"FF0000",name:"Red"},{id:"C0C0C0",name:"Silver"},{id:"008080",name:"Teal"},{id:"FFFFFF",name:"White"},{id:"FFFF00",name:"Yellow"}]},c={pencilToolRectWidth:2,pencilToolRectHeight:2,discRadius:10},d=window.location.toString().split("?")[1].split("=")[1],e=d.split("x")[0],f=d.split("x")[1],g="",h="",i="white",j=null,k=function(){for(var c=a("<div></div>"),d=a("<div></div>"),e=c,f=0,g=b.basicColors.length;g>f;f++){e=g/2>f?c:d;var h="#"+b.basicColors[f].id,i=a('<div class="color" id="Color-Hex-'+h+'" style="background-color: '+h+';"></div>');i.appendTo(e)}c.appendTo(".BasicColorPalette"),d.appendTo(".BasicColorPalette")},l=function(){var c=e-2,d=f-2;return a("<canvas/>",{id:b.canvasId}).prop({width:c,height:d}).appendTo("#"+b.containerId),a("#"+b.canvasId)[0].getContext("2d")},m=function(){a("#"+b.canvasId).on("mousemove",function(b){j.fillRect(b.pageX-a(this).offset().left,b.pageY-a(this).offset().top,2,2)})},n=function(){a("#"+b.canvasId).off("mousemove")},o={fillCirc:function(a,b,c){j.beginPath(),j.arc(a,b,c,0,2*Math.PI,!1),j.fill()}},p=function(){a("#"+b.canvasId).on("click",function(b){o.fillCirc(b.pageX-a(this).offset().left,b.pageY-a(this).offset().top,c.discRadius)})},q=function(){a("#"+b.canvasId).off("click")},r=function(){a("#"+b.canvasId).on("click",function(b){j.fillRect(b.pageX-a(this).offset().left,b.pageY-a(this).offset().top,10,10)})},s=function(){a("#"+b.canvasId).off("click")},t=function(a){return"#"+a.attr("id").split("#")[1]},u=function(d){a("#"+b.canvasId).on("mousemove",function(b){void 0!==b.buttons&&1===b.buttons&&j.fillRect(b.pageX-a(this).offset().left,b.pageY-a(this).offset().top,c.pencilToolRectWidth,c.pencilToolRectHeight)})},v=function(c){a("#"+b.canvasId).off("mousemove")},w=function(b,c){null!==y&&y.trigger("click"),a(b.tool).toggleClass("active-tool"),c(b)},x=function(b,c){a(b.tool).toggleClass("active-tool"),c(b)},y=null,z=function(){a("#FreeStyleSpeedDotsTool").funcToggle("click",function(){w({tool:this},m),y=a(this)},function(){y=null,x({tool:this},n)})},A=function(b){var d=a("<div></div>").attr("id",b.id).addClass("menu-item"),e=a("<div></div>").attr("id",b.increaseDiscSize.id).addClass("menu-item"),f=a("<i></i>").addClass(b.increaseDiscSize.icon),g=a("<a></a>").css("font-size","20px").on("click",function(){c.discRadius+=2,a(this).attr("title",c.discRadius)});f.appendTo(g),g.appendTo(e);var h=a("<div></div>").attr("id",b.decreaseDiscSize.id).addClass("menu-item"),i=a("<i></i>").addClass(b.decreaseDiscSize.icon),j=a("<a></a>").css("font-size","20px").on("click",function(){c.discRadius=c.discRadius-2===0?2:c.discRadius-2,a(this).attr("title",c.discRadius)});i.appendTo(j),j.appendTo(h),e.appendTo(d),h.appendTo(d),d.appendTo(a(b.containerSelectionCriterion))},B=function(b){a("#"+b.id).remove()},C=function(){return{tool:this,id:"DiscContextMenu",increaseDiscSize:{id:"increaseDiscSize",icon:"glyphicon glyphicon-circle-arrow-up",containerId:"DiscContextMenu"},decreaseDiscSize:{id:"decreaseDiscSize",icon:"glyphicon glyphicon-circle-arrow-down",containerId:"DiscContextMenu"},containerSelectionCriterion:".contextual-tool-bar"}},D=function(){a("#DiscTool").funcToggle("click",function(){w({tool:this},p),A(C()),y=a(this)},function(){y=null,x({tool:this},q),B(C())})},E=function(b){var d=a("<div></div>").attr("id",b.id).addClass("menu-item"),e=a("<div></div>").attr("id",b.increaseDotSize.id).addClass("menu-item"),f=a("<i></i>").addClass(b.increaseDotSize.icon),g=a("<a></a>").css("font-size","20px").on("click",function(){c.pencilToolRectWidth+=2,c.pencilToolRectHeight=c.pencilToolRectWidth,a(this).attr("title",c.pencilToolRectWidth)});f.appendTo(g),g.appendTo(e);var h=a("<div></div>").attr("id",b.decreaseDotSize.id).addClass("menu-item"),i=a("<i></i>").addClass(b.decreaseDotSize.icon),j=a("<a></a>").css("font-size","20px").on("click",function(){c.pencilToolRectWidth=c.pencilToolRectWidth-2===0?2:c.pencilToolRectWidth-2,c.pencilToolRectHeight=c.pencilToolRectWidth,a(this).attr("title",c.pencilToolRectWidth)});i.appendTo(j),j.appendTo(h),e.appendTo(d),h.appendTo(d),d.appendTo(a(b.containerSelectionCriterion))},F=function(b){a("#"+b.id).remove()},G=function(){return{tool:this,id:"PencilContextMenu",increaseDotSize:{id:"increaseDotSize",icon:"glyphicon glyphicon-circle-arrow-up",containerId:"PencilContextMenu"},decreaseDotSize:{id:"decreaseDotSize",icon:"glyphicon glyphicon-circle-arrow-down",containerId:"PencilContextMenu"},containerSelectionCriterion:".contextual-tool-bar"}},H=function(){a("#PencilTool").funcToggle("click",function(){w({tool:this},u),E(G()),y=a(this)},function(){y=null,x({tool:this},v),F(G())})},I=function(){a(".color").on("click",function(){h=j.fillStyle=t(a(this))}).on("contextmenu",function(){g=t(a(this))})},J=function(b){a("#"+b.containerId+" #"+b.toolId).on("input",function(){h=j.fillStyle=a(this).val()})},K=function(c){a("#"+c.toolId).on("click",function(){window.open(a("#"+b.canvasId)[0].toDataURL("image/png"),"_blank")})},L=function(c){a("#"+c.toolId).on("click",function(){var c=a("#"+b.canvasId)[0],d=c.height,e=c.width,f=c.getContext("2d");f.save(),f.transform(1,0,0,1,0,0),f.fillStyle=i,f.fillRect(0,0,e,d),f.restore()})},M=function(b){a("#"+b.toolId).funcToggle("click",function(){w({tool:this},r),y=a(this)},function(){y=null,x({tool:this},s)})},N=function(){I(),H(),D(),z(),J({toolId:"allColorsPicker",containerId:"HTML5ColorPicker"}),K({toolId:"save-as-image",containerId:"SaveImageButton"}),L({toolId:"reset-canvas",containerId:"ResetCanvas"}),M({toolId:"SquareTool",containerId:"jspaint-tools"})},O=function(){a("#jspaint-paint-area").css({width:e,height:f})},P=function(){a("."+b.maintoolsClass).attr("title","Click to activate;\nRight-click to deactivate;")},Q=function(){a(".top-taker").TopTaker({theme:"dark"})},R=function(){O(),j=l(),P(),Q(),k(),N(),a("#PencilTool").trigger("click")},S=function(){if(window.location.href.startsWith("file://")){mocha.setup("bdd"),mocha.reporter("html");var b=chai.assert,c=function(c){describe("Events are installed properly for "+c.name,function(){var d=a(c.selectionCriterion),e=a._data(d[0],"events");it("There is exactly one event.",function(){b(1,e.length)}),it("There is exactly one click event.",function(){b("undefined"!==e.click)})})},d=function(){c({name:"PencilTool",selectionCriterion:"#PencilTool"}),c({name:"SpeedDot",selectionCriterion:"#FreeStyleSpeedDotsTool"}),c({name:"SquareTool",selectionCriterion:"#SquareTool"}),c({name:"SquareTool",selectionCriterion:"#SquareTool"}),c({name:"Reset Canvas",selectionCriterion:"#reset-canvas"}),c({name:"Save Image",selectionCriterion:"#save-as-image"}),c({name:"Color Picker",selectionCriterion:"#allColorsPicker"}),c({name:"DiscTool",selectionCriterion:"#DiscTool"}),c({name:"Basic colors",selectionCriterion:".color"})};describe("Testing.",function(){d()})}navigator.userAgent.indexOf("PhantomJS")<0&&mocha.run()},T=function(){R(),S()};T()})}(jQuery);