/*! jspaint 2015-10-07 Anubhav Saini (c) 2015 */
$(function(){"use strict";var a={generateSlider:function(a){var b=a.min,c=a.max,d=a.title,e=a.id,f=a.step;return $('<input id="'+e+'" type="range" min="'+b+'" max="'+c+'" step="'+f+'" title="'+d+'" />')},generateLabel:function(a){var b=a.hexColor,c=a.fontSize;return $('<label style="color: #'+b+"; font-size: "+c+';"></label>')},genericLabel:function(){return a.generateLabel({hexColor:"FFFFFF",fontSize:"10px"})},registerEventForTool:function(a){var b=a.toolId,c=$(b),d=a.contextMenu,e=a.constantTitle;setupToolTips(c,e),a.tool=c,c.funcToggle("click",function(){activateTool(a),d.activate(d.getOptions())},function(){d.deactivate(d.getOptions()),deactivateTool(a)})}};$("#image-button").on("change",function(a){var b=new FileReader;b.onload=function(a){var b=new Image;b.onload=function(){context.drawImage(b,0,0)},b.src=a.target.result},b.readAsDataURL(a.target.files[0])});var b={CONSTANTS:{id:"MandelbrotFractalTool",selectionId:"#MandelbrotFractalTool","class":"main-tool",title:"Click to draw Mandelbrot Fractal. Click again to disable.",maxHeight:-1,maxWidth:-1},VARIABLES:{iterations:1e3,xMax:1,yMax:1,xMin:-2,yMin:-1,height:-1,width:-1},start:function(a){function c(a){function c(a,b,c){for(var d=0,e=0,f=0,g=0,h=0,i=c;i--&&4>=f+g;)h=d*e,f=d*d,g=e*e,d=f-g+a,e=h+h+b;return c-i}function d(a){var d,e,f,g,h,i,j,k=a.context,l=a.XMin,m=a.YMin,n=a.XMax,o=a.YMax,p=a.iterations,q=b.VARIABLES.width,r=b.VARIABLES.height,s=k.getImageData(0,0,q,r),t=s.data,u=Color.hexToRgb(selectedPrimaryColor);for(d=0;q>d;++d)for(e=0;r>e;++e)f=l+(n-l)*d/(q-1),g=m+(o-m)*e/(r-1),h=c(f,g,p),j=4*(q*e+d),h>p?(t[j]=u.r,t[j+1]=u.g,t[j+2]=u.b):(i=3*Math.log(h)/Math.log(p-1),1>i?(t[j]=255*i,t[j+1]=0,t[j+2]=0):2>i?(t[j]=255,t[j+1]=255*(i-1),t[j+2]=0):(t[j]=255,t[j+1]=255,t[j+2]=255*(i-2))),t[j+3]=255;k.putImageData(s,a.startX,a.startY)}d(a)}var d=a.event,e=a.canvasId,f=function(a){return a+Math.floor(b.VARIABLES.width)-b.CONSTANTS.maxWidth},g=function(a){var c=Actions.Mouse.getX(a),d=Math.max(c-Math.floor(b.VARIABLES.width/2),0),e=f(d);return e>0&&(d-=e),d},h=function(a){return a+Math.floor(b.VARIABLES.height)-b.CONSTANTS.maxHeight},i=function(a){var c=Actions.Mouse.getY(a),d=Math.max(c-Math.floor(b.VARIABLES.height/2),0),e=h(d);return e>0&&(d-=e),d};$(e).on(d,function(a){var d={event:a,relativeTo:$(e)},f=g(d),h=i(d);c({context:context,XMin:b.VARIABLES.xMin,XMax:b.VARIABLES.xMax,YMin:b.VARIABLES.yMin,YMax:b.VARIABLES.yMax,iterations:b.VARIABLES.iterations,startX:f,startY:h})})},stop:function(a){$(a.canvasId).off(a.event)},ContextMenu:{activate:function(c){function d(b,c,d,e){return a.generateSlider({id:b,min:c,max:d,step:1,title:e})}function e(c){function e(a){var c=d("mandelbrotIterations","10",a.maxIterationsAllowed,"Iterations for mandelbrot fractal generation. Beware! If higher values are used, it might crash your browser.").attr("value",b.VARIABLES.iterations).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){var c=$(this).val();c>a.maxIterationsAllowed&&confirm("Beware! It might crash your browser. Go back?","back","No, I want these many iterations. I know what I am doing!")&&(c=a.maxIterationsAllowed),b.VARIABLES.iterations=c});return c}var f=a.genericLabel().append(c.iterationLabel).append(e(c));return f}function f(c){function e(a){var c=d("mandelbrotHeight","100",b.CONSTANTS.maxHeight,"Height for mandelbrot fractal generation.").attr("value",b.CONSTANTS.maxHeight).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){var a=$(this).val();a>b.CONSTANTS.maxHeight&&(a=b.CONSTANTS.maxHeight),b.VARIABLES.height=a});return c}var f=a.genericLabel().append(c.heightLabel).append(e(c));return f}function g(c){function e(a){var c=d("mandelbrotWidth","100",b.CONSTANTS.maxWidth,"Width for mandelbrot fractal generation.").attr("value",b.CONSTANTS.maxWidth).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){var a=$(this).val();a>b.CONSTANTS.maxWidth&&(a=b.CONSTANTS.maxWidth),b.VARIABLES.width=a});return c}var f=a.genericLabel().append(c.widthLabel).append(e(c));return f}function h(c){function e(a){var c=d("mandelbrotXMax","0","3","XMax for mandelbrot fractal generation.").attr("value","1").attr("disabled","disabled").on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){b.VARIABLES.xMax=$(this).val()});return c}var f=a.genericLabel().append(c.xMaxLabel).append(e(c));return f}function i(c){function e(a){var c=d("mandelbrotYMax","0","3","YMax for mandelbrot fractal generation.").attr("value","1").attr("disabled","disabled").on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){b.VARIABLES.yMax=$(this).val()});return c}var f=a.genericLabel().append(c.yMaxLabel).append(e(c));return f}function j(c){function e(a){var c=d("mandelbrotXMin","-3","1","XMin for mandelbrot fractal generation.").attr("value","-2").attr("disabled","disabled").on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){b.VARIABLES.xMin=$(this).val()});return c}var f=a.genericLabel().append(c.xMinLabel).append(e(c));return f}function k(c){function e(a){var c=d("mandelbrotYMin","-2","1","YMin for mandelbrot fractal generation.").attr("value","-1").attr("disabled","disabled").on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){b.VARIABLES.yMin=$(this).val()});return c}var f=a.genericLabel().append(c.yMinLabel).append(e(c));return f}var l=$("<div></div>").attr("id",c.id).addClass("menu-item");l.append(e(c)),l.append(f(c)),l.append(g(c)),l.append(h(c)),l.append(i(c)),l.append(j(c)),l.append(k(c)),l.appendTo($(c.containerSelectionCriterion))},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"MandelbrotFractalContextMenu",containerSelectionCriterion:".contextual-tool-bar",maxIterationsAllowed:2e3,minIterationsAllowed:10,iterationLabel:"Iterations: ",maxHeightAllowed:b.VARIABLES.maxHeight,heightLabel:"Height: ",maxWidthAllowed:b.VARIABLES.maxWidth,widthLabel:"Width: ",xMaxLabel:"XMax: ",yMaxLabel:"YMax: ",xMinLabel:"XMin: ",yMinLabel:"YMin: "}}},Events:{register:function(a){var c=a.toolId,d=$(c),e=b.ContextMenu;setupToolTips(d,b.CONSTANTS.title),a.tool=d,d.funcToggle("click",function(){activateTool(a),b.VARIABLES.height=b.CONSTANTS.maxHeight=$(a.canvasId)[0].height,b.VARIABLES.width=b.CONSTANTS.maxWidth=$(a.canvasId)[0].width,e.activate(e.getOptions())},function(){e.deactivate(e.getOptions()),deactivateTool(a)})}}};b.Events.register({toolId:b.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:"#"+CONSTANTS.canvasId,start:b.start,stop:b.stop,toolName:"Mandelbrot fractal"});var c={CONSTANTS:{id:"PencilTool",selectionId:"#PencilTool","class":"main-tool",title:"Click to draw free-hand lines. Click again to disable."},VARIABLES:{width:2,LastPoint:{X:-1,Y:-1}},start:function(a){var b=a.event,d="#"+a.canvasId,e=null,f=null,g=null,h=null,i=null,j={get:function(){return{X:c.VARIABLES.LastPoint.X,Y:c.VARIABLES.LastPoint.Y}},set:function(a,b){c.VARIABLES.LastPoint.X=a,c.VARIABLES.LastPoint.Y=b}};$(d).on(b,function(a){e={event:a,relativeTo:$(this)};var b=function(){f=Actions.Mouse.getX(e),g=Actions.Mouse.getY(e),h=c.VARIABLES.width,i=j.get(),-1!=i.X&&CANVASAPI.drawLineSegmentFromLastPoint({context:context,last:i,current:{X:f,Y:g},width:h}),j.set(f,g)};void 0!==a.buttons&&(1===a.buttons?b():(c.VARIABLES.LastPoint.X=-1,c.VARIABLES.LastPoint.Y=-1))})},stop:function(a){var b=a.event||CONSTANTS.Events.mousemove,c="#"+(a.canvasId||CONSTANTS.canvasId);$(c).off(b)},ContextMenu:{activate:function(b){function d(){return a.generateSlider({id:"widthPencil",min:1,max:200,step:1,title:"Width for pencil tool."})}function e(a){var b=$("<div></div>").attr("id",a.id).addClass("menu-item");d().attr("value",c.VARIABLES.width).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){c.VARIABLES.width=$(this).val()}).appendTo(b);b.appendTo($(a.containerSelectionCriterion))}e(b)},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"PencilContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:c.CONSTANTS.selectionId,event:CONSTANTS.Events.mousemove,canvasId:CONSTANTS.canvasId,start:c.start,stop:c.stop,toolName:"Pencil",contextMenu:c.ContextMenu,constantTitle:c.CONSTANTS.title});var d={CONSTANTS:{id:"pick-color",selectionId:"#pick-color","class":"string-menu-item",containerId:"PickColorTool",title:"Click to pick color under mouse pointer tip; picks until some other tool is selected. Click again to disable."},ContextMenu:{activate:function(){},deactivate:function(){},getOptions:function(){}},start:function(a){var b=a.event,c="#"+a.canvasId,d=null,e=null,f=null,g=null,h=0,i=0,j=0,k=0;$(c).on(b,function(a){d={event:a,relativeTo:$(this)},e=Actions.Mouse.getX(d),f=Actions.Mouse.getY(d),g=context.getImageData(e-.5,f-.5,e+.5,f+.5).data,h=g[0],i=g[1],j=g[2],k=g[3],selectedPrimaryColor=context.fillStyle="rgba("+h+", "+i+", "+j+", "+k+")"})},stop:function(a){var b=a.event,c="#"+a.canvasId;$(c).off(b)}};a.registerEventForTool({toolId:d.CONSTANTS.selectionId,containerId:d.CONSTANTS.containerId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:d.start,stop:d.stop,toolName:"Color picker",contextMenu:d.ContextMenu,constantTitle:d.CONSTANTS.title});var e={CONSTANTS:{id:"PivotedLinePatternTool",selectionId:"#PivotedLinePatternTool","class":"main-tool",title:"Click to draw amazing pattern. Click again to disable.",ACTIONS:{pivots:"pivots",Ydrops:"drops",godRays:"god-rays",Xextends:"extends"}},VARIABLES:{width:2,LastPoint:{X:-1,Y:-1}},start:function(a){var b=a.event||CONSTANTS.Events.mousemove,c="#"+(a.canvasId||CONSTANTS.canvasId),d=null,f=null,g=null,h=null,i=null,j={get:function(){return{X:e.VARIABLES.LastPoint.X,Y:e.VARIABLES.LastPoint.Y}},set:function(a,b){e.VARIABLES.LastPoint.X=a,e.VARIABLES.LastPoint.Y=b}},k=null;$(c).on(b,function(a){d={event:a,relativeTo:$(this)},f=Actions.Mouse.getX(d),g=Actions.Mouse.getY(d),k=$("[name=tool-options]:checked").val();var b=function(){h=e.VARIABLES.width,i=j.get(),-1!=i.X&&CANVASAPI.drawLineSegmentFromLastPoint({context:context,last:i,current:{X:f,Y:g},width:h}),k===e.CONSTANTS.ACTIONS.Xextends&&j.set(0,g),k===e.CONSTANTS.ACTIONS.Ydrops&&j.set(f,0),k===e.CONSTANTS.ACTIONS.godRays&&j.set(0,0)};void 0!==a.buttons&&(1===a.buttons?b():(j.set(-1,-1),k===e.CONSTANTS.ACTIONS.pivots&&j.set(f,g)))})},stop:function(a){var b=a.event||CONSTANTS.Events.mousemove,c="#"+(a.canvasId||CONSTANTS.canvasId);$(c).off(b)},ContextMenu:{activate:function(b){function c(){return a.generateSlider({id:"widthPivotedLinePattern",min:1,max:200,step:1,title:"width for pivoted line pattern tool."})}function d(a){c().attr("value",e.VARIABLES.width).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){e.VARIABLES.width=$(this).val()}).appendTo(f);f.appendTo($(a.containerSelectionCriterion))}var f=$("<div></div>").attr("id",b.id).addClass("menu-item"),g=function(){var b=function(b,c,d){return a.genericLabel().append(d).append(' <input id="'+b+'" name="'+c+'" type="radio" value="'+d+'" /></label>')};f.append(b("option_pivot","tool-options",e.CONSTANTS.ACTIONS.pivots)),f.append(b("option_extends","tool-options",e.CONSTANTS.ACTIONS.Xextends)),f.append(b("option_drops","tool-options",e.CONSTANTS.ACTIONS.Ydrops)),f.append(b("option_god_rays","tool-options",e.CONSTANTS.ACTIONS.godRays))};d(b),g()},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"PivotedLinePatternContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:e.CONSTANTS.selectionId,event:CONSTANTS.Events.mousemove,canvasId:CONSTANTS.canvasId,start:e.start,stop:e.stop,toolName:"Pivoted Line Pattern",contextMenu:e.ContextMenu,constantTitle:e.CONSTANTS.title});var f={CONSTANTS:{id:"RectangleTool",selectionId:"#RectangleTool","class":"main-tool",title:"Click to draw rectangles. Click again to disable.",previewId:"previewRectangle"},VARIABLES:{length:20,breadth:10,xyPlaneRotationAngle:360},start:function(a){function b(a){$("<div></div>").attr("id",f.CONSTANTS.previewId).css({position:"fixed","z-index":"2"}).appendTo(".utilities").on("click",function(a){var b={event:a,relativeTo:$(c)},d=Actions.Mouse.getX(b),e=Actions.Mouse.getY(b),g=f.VARIABLES.length,h=f.VARIABLES.breadth;l=f.VARIABLES.xyPlaneRotationAngle*Math.PI/180,CANVASAPI.fillRotatedRectangle(d-g/2,e-h/2,g,h,l)}).on("mousemove",function(a){$(this).css("top",a.pageY-f.VARIABLES.breadth/2-window.scrollY).css("left",a.pageX-f.VARIABLES.length/2-window.scrollX).css("background-color",selectedPrimaryColor).css("border","thin dashed "+selectedAlternativeColor).css("height",f.VARIABLES.breadth).css("width",f.VARIABLES.length),j=$(this).offset().left+f.VARIABLES.length/2,k=$(this).offset().top+f.VARIABLES.breadth/2,e=$(c).offset().left,g=$(c).offset().top,(e>j||j>e+i||g>k||k>g+h)&&$(this).hide()})}var c=(a.event,"#"+a.canvasId),d=null,e=$(c).offset().left,g=$(c).offset().top,h=$(c).height(),i=$(c).width(),j=null,k=null,l=null;b(),$(c).on("mousemove",function(a){d=d||$("#"+f.CONSTANTS.previewId),d.css("top",a.pageY-f.VARIABLES.breadth/2-window.scrollY).css("left",a.pageX-f.VARIABLES.length/2-window.scrollX).css("background-color",selectedPrimaryColor).css("height",f.VARIABLES.breadth).css("width",f.VARIABLES.length).css("transform","rotate("+parseInt(f.VARIABLES.xyPlaneRotationAngle*Math.PI)/180+"rad)").show()})},stop:function(a){var b=a.event||CONSTANTS.Events.mouseclick,c="#"+(a.canvasId||CONSTANTS.canvasId);$(c).off(b),$("#"+f.CONSTANTS.previewId).off("mousemove"),$("#"+f.CONSTANTS.previewId).remove()},ContextMenu:{activate:function(b){function c(b,c,d,e){return a.generateSlider({id:b,min:e,max:d,step:1,title:c})}function d(a){return c("xyPlaneRotationAngle","rotation angle for XY plane rotation.",360,0).attr("value",f.VARIABLES.xyPlaneRotationAngle).on("mouseover",function(){$(this).attr("title",$(this).val()+" deg")}).on("input",function(){f.VARIABLES.xyPlaneRotationAngle=$(this).val()})}function e(a){c(a.lengthId,a.lengthTitle,400,10).attr("value",f.VARIABLES.length).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){f.VARIABLES.length=$(this).val()}).appendTo(g),c(a.breadthId,a.breadthTitle,400,10).attr("value",f.VARIABLES.breadth).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){f.VARIABLES.breadth=$(this).val()}).appendTo(g)}var g=$("<div></div>").attr("id",b.id).addClass("menu-item");e(b),g.append(d(b)),g.appendTo($(b.containerSelectionCriterion))},deactivate:function(a){function b(a){$("#"+a.lengthId).remove(),$("#"+a.breadthId).remove(),$("#xyPlaneRotationAngle").remove()}b(a),$("#"+f.CONSTANTS.previewId).off("mousemove"),$("#"+f.CONSTANTS.previewId).remove()},getOptions:function(){return{tool:this,id:"RectangleContextMenu",lengthId:"lengthRectangle",breadthId:"breadthRectangle",lengthTitle:"length for rectangle",breadthTitle:"breadth for rectangle",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:f.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:f.start,stop:f.stop,toolName:"Rectangle",contextMenu:f.ContextMenu,constantTitle:f.CONSTANTS.title});var g={CONSTANTS:{id:"RingTool",selectionId:"#RingTool","class":"main-tool",title:"Click to draw ring. Click again to disable.",previewId:"previewRing",previewOuterId:"previewOuterRing"},VARIABLES:{innerRadius:10,outerRadius:20},start:function(a){function b(a){var b=$("<div></div>").attr("id",g.CONSTANTS.previewOuterId).css({position:"fixed","z-index":"2","border-radius":"50%",height:2*g.VARIABLES.outerRadius,width:2*g.VARIABLES.outerRadius,"backgruond-color":selectedPrimaryColor}).appendTo(".utilities");$("<div></div>").attr("id",g.CONSTANTS.previewId).css({position:"fixed","z-index":"2","border-radius":"50%"}).appendTo(b).on("click",function(a){d={event:a,relativeTo:$(c)},e=Actions.Mouse.getX(d),f=Actions.Mouse.getY(d),h=g.VARIABLES.innerRadius,i=g.VARIABLES.outerRadius,CANVASAPI.fillRing({X:e,Y:f,innerRadius:h,outerRadius:i,strokeColor:selectedPrimaryColor,fillColor:selectedAlternativeColor})}).on("mousemove",function(a){$(this).css("top",a.pageY-parseInt(g.VARIABLES.innerRadius)-parseInt(window.scrollY)).css("left",a.pageX-parseInt(g.VARIABLES.innerRadius)-parseInt(window.scrollX)).css("background-color",selectedAlternativeColor).css("border","thin dashed "+selectedPrimaryColor).css("height",2*g.VARIABLES.innerRadius).css("width",2*g.VARIABLES.innerRadius),q.css({position:"fixed",top:a.pageY-parseInt(g.VARIABLES.outerRadius)-parseInt(window.scrollY),left:a.pageX-parseInt(g.VARIABLES.outerRadius)-parseInt(window.scrollX),"z-index":"2","border-radius":"50%",height:2*g.VARIABLES.outerRadius,width:2*g.VARIABLES.outerRadius,"background-color":selectedPrimaryColor}),o=$(this).offset().left+parseInt(g.VARIABLES.innerRadius),p=$(this).offset().top+parseInt(g.VARIABLES.innerRadius),k=$(c).offset().left,l=$(c).offset().top,(k>o||parseInt(k)+parseInt(n)<o||l>p||parseInt(l)+parseInt(m)<p)&&($(this).hide(),q.hide())})}var c=(a.event||CONSTANTS.Events.mouseclick,"#"+(a.canvasId||CONSTANTS.canvasId)),d=null,e=null,f=null,h=null,i=null,j=null,k=null,l=null,m=$(c).height(),n=$(c).width(),o=null,p=null,q=null;b(),$(c).on("mousemove",function(a){j=j||$("#"+g.CONSTANTS.previewId),j.css("top",a.pageY-parseInt(g.VARIABLES.innerRadius)-parseInt(window.scrollY)).css("left",a.pageX-parseInt(g.VARIABLES.innerRadius)-parseInt(window.scrollX)).css("background-color",selectedAlternativeColor).css("height",2*g.VARIABLES.innerRadius).css("width",2*g.VARIABLES.innerRadius).show(),q=q||$("#"+g.CONSTANTS.previewOuterId),q.css({position:"fixed",top:a.pageY-parseInt(g.VARIABLES.outerRadius)-parseInt(window.scrollY),left:a.pageX-parseInt(g.VARIABLES.outerRadius)-parseInt(window.scrollX),"z-index":"2","border-radius":"50%",height:2*g.VARIABLES.outerRadius,width:2*g.VARIABLES.outerRadius,"background-color":selectedPrimaryColor}).show()})},stop:function(a){var b=a.event||CONSTANTS.Events.mouseclick,c="#"+(a.canvasId||CONSTANTS.canvasId);$(c).off(b),$("#"+g.CONSTANTS.previewId).off("mousemove"),$("#"+g.CONSTANTS.previewId).remove(),$("#"+g.CONSTANTS.previewOuterId).remove()},ContextMenu:{activate:function(b){function c(b,c){return a.generateSlider({id:b,min:1,max:200,step:1,title:c})}function d(a){var b=$("<div></div>").attr("id",a.id).addClass("menu-item");c("innerRadiusRing","inner radius for ring tool.").attr("value",g.VARIABLES.innerRadius).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){g.VARIABLES.innerRadius=$(this).val()}).appendTo(b),c("outerRadiusRing","outer radius for ring tool.").attr("value",g.VARIABLES.outerRadius).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){g.VARIABLES.outerRadius=$(this).val()}).appendTo(b);b.appendTo($(a.containerSelectionCriterion))}d(b)},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"RingContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:g.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:g.start,stop:g.stop,toolName:"Ring",contextMenu:g.ContextMenu,constantTitle:g.CONSTANTS.title});var h={CONSTANTS:{id:"DiscTool",selectionId:"#DiscTool","class":"main-tool",title:"Click to draw disc. Click again to disable.",previewId:"previewDisc"},VARIABLES:{radius:10},start:function(a){function b(a){$("<div></div>").attr("id",h.CONSTANTS.previewId).css({position:"fixed","z-index":"2","border-radius":"50%"}).appendTo(".utilities").on("click",function(a){d={event:a,relativeTo:$(c)},e=Actions.Mouse.getX(d),f=Actions.Mouse.getY(d),g=h.VARIABLES.radius,CANVASAPI.fillCirc(e,f,g)}).on("mousemove",function(a){$(this).css("top",a.pageY-h.VARIABLES.radius-window.scrollY).css("left",a.pageX-h.VARIABLES.radius-window.scrollX).css("background-color",selectedPrimaryColor).css("border","thin dashed "+selectedAlternativeColor).css("height",2*h.VARIABLES.radius).css("width",2*h.VARIABLES.radius),n=parseInt($(this).offset().left)+parseInt(h.VARIABLES.radius),o=parseInt($(this).offset().top)+parseInt(h.VARIABLES.radius),j=$(c).offset().left,k=$(c).offset().top,(j>n||parseInt(j)+parseInt(m)<n||k>o||parseInt(k)+parseInt(l)<o)&&$(this).hide()})}var c=(a.event,"#"+a.canvasId),d=null,e=null,f=null,g=null,i=null,j=$(c).offset().left,k=$(c).offset().top,l=$(c).height(),m=$(c).width(),n=null,o=null;b(),$(c).on("mousemove",function(a){i=i||$("#"+h.CONSTANTS.previewId),i.css("top",a.pageY-h.VARIABLES.radius-window.scrollY).css("left",a.pageX-h.VARIABLES.radius-window.scrollX).css("background-color",selectedPrimaryColor).css("height",2*h.VARIABLES.radius).css("width",2*h.VARIABLES.radius).show()})},stop:function(a){var b=a.event,c="#"+a.canvasId;$(c).off(b),$("#"+h.CONSTANTS.previewId).off("mousemove"),$("#"+h.CONSTANTS.previewId).remove()},ContextMenu:{activate:function(b){function c(){return a.generateSlider({id:"radiusDisc",min:1,max:200,step:1,title:"radius for disc tool."})}function d(a){var b=$("<div></div>").attr("id",a.id).addClass("menu-item");c().attr("value",h.VARIABLES.radius).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){h.VARIABLES.radius=$(this).val()}).appendTo(b);b.appendTo($(a.containerSelectionCriterion))}d(b)},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"DiscContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:h.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:h.start,stop:h.stop,toolName:"Disc",contextMenu:h.ContextMenu,constantTitle:h.CONSTANTS.title});var i={CONSTANTS:{id:"SquareTool",selectionId:"#SquareTool","class":"main-tool",title:"Click to draw squares. Click again to disable.",previewId:"previewSquare"},VARIABLES:{side:10,xyPlaneRotationAngle:360},start:function(a){function b(a){$("<div></div>").attr("id",i.CONSTANTS.previewId).css({position:"fixed","z-index":"2"}).appendTo(".utilities").on("click",function(a){var b={event:a,relativeTo:$(c)},d=Actions.Mouse.getX(b),e=Actions.Mouse.getY(b),f=i.VARIABLES.side,g=i.VARIABLES.xyPlaneRotationAngle*Math.PI/180;CANVASAPI.fillRoatedSquare(d-f/2,e-f/2,f,g)}).on("mousemove",function(a){$(this).css("top",parseInt(a.pageY)-parseInt(i.VARIABLES.side/2)-parseInt(window.scrollY)).css("left",parseInt(a.pageX)-parseInt(parseInt(i.VARIABLES.side/2))-parseInt(window.scrollX)).css("background-color",selectedPrimaryColor).css("border","thin dashed "+selectedAlternativeColor).css("height",i.VARIABLES.side).css("width",i.VARIABLES.side),j=parseInt($(this).offset().left)+parseInt(i.VARIABLES.side/2),k=parseInt($(this).offset().top)+parseInt(i.VARIABLES.side/2),e=$(c).offset().left,f=$(c).offset().top,(e>j||parseInt(e+h)<j||f>k||parseInt(f+g)<k)&&$(this).hide()})}var c=(a.event||CONSTANTS.Events.mouseclick,"#"+(a.canvasId||CONSTANTS.canvasId)),d=null,e=$(c).offset().left,f=$(c).offset().top,g=$(c).height(),h=$(c).width(),j=null,k=null;b(),$(c).on("mousemove",function(a){d=d||$("#"+i.CONSTANTS.previewId),d.css("top",a.pageY-parseInt(i.VARIABLES.side/2)-window.scrollY).css("left",a.pageX-parseInt(i.VARIABLES.side/2)-window.scrollX).css("background-color",selectedPrimaryColor).css("height",i.VARIABLES.side).css("width",i.VARIABLES.side).css("transform","rotate("+parseInt(i.VARIABLES.xyPlaneRotationAngle*Math.PI)/180+"rad)").show()})},stop:function(a){var b=a.event||CONSTANTS.Events.mouseclick,c="#"+(a.canvasId||CONSTANTS.canvasId);$(c).off(b)},ContextMenu:{activate:function(b){function c(b,c,d,e){return a.generateSlider({id:b,min:e,max:d,step:1,title:c})}function d(a){var b=$("#"+a.id);return 0===b.length?$("<div></div>").attr("id",a.id).addClass("menu-item"):b}function e(a){return c("sideSquare","side length for square tool",200,10).attr("value",i.VARIABLES.side).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){i.VARIABLES.side=$(this).val()})}function f(a){return c("xyPlaneRotationAngle","rotation angle for XY plane rotation.",360,0).attr("value",i.VARIABLES.xyPlaneRotationAngle).on("mouseover",function(){$(this).attr("title",$(this).val()+" deg")}).on("input",function(){i.VARIABLES.xyPlaneRotationAngle=$(this).val()})}var g=d(b);e(b).appendTo(g),f(b).appendTo(g),g.appendTo($(b.containerSelectionCriterion))},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a),$("#"+i.CONSTANTS.previewId).off("mousemove"),$("#"+i.CONSTANTS.previewId).remove()},getOptions:function(){return{tool:this,id:"SquareToolContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:i.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:i.start,stop:i.stop,toolName:"Square",contextMenu:i.ContextMenu,constantTitle:i.CONSTANTS.title});var j={CONSTANTS:{id:"CircleTool",selectionId:"#CircleTool","class":"main-tool",title:"Click to draw circle. Click again to disable.",previewId:"previewCircle"},VARIABLES:{innerRadius:10},start:function(a){function b(a){$("<div></div>").attr("id",j.CONSTANTS.previewId).css({position:"fixed","z-index":"2","border-radius":"50%"}).appendTo(".utilities").on("click",function(a){d={event:a,relativeTo:$(c)},e=Actions.Mouse.getX(d),f=Actions.Mouse.getY(d),g=j.VARIABLES.innerRadius,h=parseInt(j.VARIABLES.innerRadius)+1,CANVASAPI.drawCircle({X:e,Y:f,innerRadius:g,outerRadius:h,strokeColor:selectedPrimaryColor})}).on("mousemove",function(a){$(this).css("top",a.pageY-j.VARIABLES.innerRadius-window.scrollY).css("left",a.pageX-j.VARIABLES.innerRadius-window.scrollX).css("border","thin solid "+selectedPrimaryColor).css("height",2*j.VARIABLES.innerRadius).css("width",2*j.VARIABLES.innerRadius),o=parseInt($(this).offset().left)+parseInt(j.VARIABLES.innerRadius),p=parseInt($(this).offset().top)+parseInt(j.VARIABLES.innerRadius),k=$(c).offset().left,l=$(c).offset().top,(k>o||parseInt(k)+parseInt(n)<o||l>p||parseInt(l)+parseInt(m)<p)&&$(this).hide()})}var c=(a.event||CONSTANTS.Events.mouseclick,"#"+(a.canvasId||CONSTANTS.canvasId)),d=null,e=null,f=null,g=null,h=null,i=null,k=null,l=null,m=$(c).height(),n=$(c).width(),o=null,p=null;b(),$(c).on("mousemove",function(a){i=i||$("#"+j.CONSTANTS.previewId),i.css("top",a.pageY-j.VARIABLES.innerRadius-window.scrollY).css("left",a.pageX-j.VARIABLES.innerRadius-window.scrollX).css("border","thin solid "+selectedPrimaryColor).css("height",2*j.VARIABLES.innerRadius).css("width",2*j.VARIABLES.innerRadius).show()})},stop:function(a){var b=a.event||CONSTANTS.Events.mouseclick,c="#"+(a.canvasId||CONSTANTS.canvasId);$(c).off(b),$("#"+j.CONSTANTS.previewId).off("mousemove"),$("#"+j.CONSTANTS.previewId).remove()},ContextMenu:{activate:function(b){function c(b,c){return a.generateSlider({id:b,min:1,max:200,step:1,title:c})}function d(a){var b=$("<div></div>").attr("id",a.id).addClass("menu-item"),d=c("radiusCircle","innerRadius for circle tool.").attr("value",j.VARIABLES.innerRadius).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){j.VARIABLES.innerRadius=$(this).val()});d.appendTo(b),b.appendTo($(a.containerSelectionCriterion))}d(b)},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"CircleContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}}};a.registerEventForTool({toolId:j.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:j.start,stop:j.stop,toolName:"Circle",contextMenu:j.ContextMenu,constantTitle:j.CONSTANTS.title});var k={CONSTANTS:{id:"PointWalkerTool",selectionId:"#PointWalkerTool","class":"main-tool",title:"Click to draw random point walker. Click again to disable."},VARIABLES:{steps:100},start:function(a){var b=a.event,c="#"+a.canvasId,d=null,e=null,f=null,g=0;$(c).on(b,function(a){for(d={event:a,relativeTo:$(c)},e=Actions.Mouse.getX(d),f=Actions.Mouse.getY(d),g=0;g<k.VARIABLES.steps;g++)CANVASAPI.fillCirc(e,f,1),e+=Math.random()<.5?-1:1,f-=Math.random()<.5?-1:1})},stop:function(a){$("#"+a.canvasId).off(a.event)},ContextMenu:{activate:function(b){function c(b,c,d,e){return a.generateSlider({id:b,min:c,max:d,step:1,title:e})}function d(b){function d(a){var b=c("pointWalkerSptes","500",a.maxStepsAllowed,"Steps for random point walk generation.").attr("value",k.VARIABLES.steps).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){k.VARIABLES.steps=$(this).val()});return b}return a.genericLabel().append(b.stepLabel).append(d(b))}var e=$("<div></div>").attr("id",b.id).addClass("menu-item");e.append(d(b)),e.appendTo($(b.containerSelectionCriterion))},deactivate:function(a){$("#"+a.id).remove()},getOptions:function(){return{tool:this,id:"PointWalkerContextMenu",containerSelectionCriterion:".contextual-tool-bar",maxStepsAllowed:1e5,stepLabel:"Steps: "}}}};a.registerEventForTool({toolId:k.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:k.start,stop:k.stop,toolName:"Point Walker",contextMenu:k.ContextMenu,constantTitle:k.CONSTANTS.title});var l={CONSTANTS:{id:"FamilyPointWalkerTool",selectionId:"#FamilyPointWalkerTool","class":"main-tool",title:"Click to draw family random point walker. Click again to disable."},VARIABLES:{steps:100,durationBetweenDanceStepsInMiliSeconds:100},start:function(a){var b,c,d=a.event,e="#"+a.canvasId,f=null,g=null,h=null,i=0,j=[],k={};$(e).on(d,function(a){function d(a){for(g=a.X,h=a.Y,b=a.steps,c=a.fillColor,i=0;b>i;i++)j[i]={X:g,Y:h},context.fillStyle=c,CANVASAPI.fillCirc(g,h,1),g+=Math.random()<.5?-1:1,h-=Math.random()<.5?-1:1;setTimeout(function(){d(a)},1e3)}f={event:a,relativeTo:$(e)},g=Actions.Mouse.getX(f),h=Actions.Mouse.getY(f),k={X:g,Y:h,steps:l.VARIABLES.steps,fillColor:selectedPrimaryColor},setTimeout(function(){d(k)},1e3)})},stop:function(a){$("#"+a.canvasId).off(a.event)},ContextMenu:{activate:function(b){function c(b,c,d,e){return a.generateSlider({id:b,min:c,max:d,step:1,title:e})}function d(b){function d(a){var b=c("familyPointWalkerSptes",l.VARIABLES.steps,a.maxStepsAllowed,"Steps for family random point walk generation.").attr("value",l.VARIABLES.steps).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){l.VARIABLES.steps=$(this).val()});return b}return a.genericLabel().append(b.stepLabel).append(d(b))}var e=$("<div></div>").attr("id",b.id).addClass("menu-item");e.append(d(b)),e.appendTo($(b.containerSelectionCriterion))},deactivate:function(a){$("#"+a.id).remove()},getOptions:function(){return{tool:this,id:"FamilyPointWalkerContextMenu",containerSelectionCriterion:".contextual-tool-bar",maxStepsAllowed:1e5,stepLabel:"Steps: "}}}};a.registerEventForTool({toolId:l.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:l.start,stop:l.stop,toolName:"Family Point Walker",contextMenu:l.ContextMenu,constantTitle:l.CONSTANTS.title});var m={CONSTANTS:{id:"OrganismPointWalkerTool",selectionId:"#OrganismPointWalkerTool","class":"main-tool",title:"Click to draw organism random point walker. Click again to disable."},VARIABLES:{steps:100,durationBetweenDanceStepsInMiliSeconds:100},start:function(a){var b,c,d=a.event,e="#"+a.canvasId,f=null,g=null,h=null,i=0,j=[],k={};$(e).on(d,function(a){function d(a){for(g=a.X,h=a.Y,b=a.steps,c=a.fillColor,i=0;b>i;i++)j[i]={X:g,Y:h},context.fillStyle=c,CANVASAPI.fillCirc(g,h,1),g+=Math.random()<.5?-1:1,h-=Math.random()<.5?-1:1;a.X=g,a.Y=h,setTimeout(function(){d(a)},1e3)}f={event:a,relativeTo:$(e)},g=Actions.Mouse.getX(f),h=Actions.Mouse.getY(f),k={X:g,Y:h,steps:m.VARIABLES.steps,fillColor:selectedPrimaryColor},setTimeout(function(){d(k)},1e3)});
},stop:function(a){$("#"+a.canvasId).off(a.event)},ContextMenu:{activate:function(b){function c(b,c,d,e){return a.generateSlider({id:b,min:c,max:d,step:1,title:e})}function d(b){function d(a){var b=c("organismPointWalkerSptes",m.VARIABLES.steps,a.maxStepsAllowed,"Steps for organism random point walk generation.").attr("value",m.VARIABLES.steps).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("change",function(){m.VARIABLES.steps=$(this).val()});return b}return a.genericLabel().append(b.stepLabel).append(d(b))}var e=$("<div></div>").attr("id",b.id).addClass("menu-item");e.append(d(b)),e.appendTo($(b.containerSelectionCriterion))},deactivate:function(a){$("#"+a.id).remove()},getOptions:function(){return{tool:this,id:"OrganismPointWalkerContextMenu",containerSelectionCriterion:".contextual-tool-bar",maxStepsAllowed:1e4,stepLabel:"Steps: "}}}};a.registerEventForTool({toolId:m.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:m.start,stop:m.stop,toolName:"Organism Point Walker",contextMenu:m.ContextMenu,constantTitle:m.CONSTANTS.title}),$("#SaturateRedColorTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width(),d=context.getImageData(0,0,c,b);saveCanvasState({startX:0,startY:0,width:c,height:b});for(var e=0;e<d.data.length;e+=4)d.data[e]=255;context.putImageData(d,0,0)}),$("#SaturateGreenColorTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width(),d=context.getImageData(0,0,c,b);saveCanvasState({startX:0,startY:0,width:c,height:b});for(var e=1;e<d.data.length;e+=4)d.data[e]=255;context.putImageData(d,0,0)}),$("#SaturateBlueColorTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width(),d=context.getImageData(0,0,c,b);saveCanvasState({startX:0,startY:0,width:c,height:b});for(var e=2;e<d.data.length;e+=4)d.data[e]=255;context.putImageData(d,0,0)}),$("#InvertColorsTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width(),d=context.getImageData(0,0,c,b);saveCanvasState({startX:0,startY:0,width:c,height:b});for(var e=0;e<d.data.length;e+=4)d.data[e]=255-d.data[e],d.data[e+1]=255-d.data[e+1],d.data[e+2]=255-d.data[e+2];context.putImageData(d,0,0)}),$("#DesaturateRedColorTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width(),d=context.getImageData(0,0,c,b);saveCanvasState({startX:0,startY:0,width:c,height:b});for(var e=0;e<d.data.length;e+=4)d.data[e]=0;context.putImageData(d,0,0)}),$("#DesaturateGreenColorTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width(),d=context.getImageData(0,0,c,b);saveCanvasState({startX:0,startY:0,width:c,height:b});for(var e=1;e<d.data.length;e+=4)d.data[e]=0;context.putImageData(d,0,0)}),$("#DesaturateBlueColorTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width(),d=context.getImageData(0,0,c,b);saveCanvasState({startX:0,startY:0,width:c,height:b});for(var e=2;e<d.data.length;e+=4)d.data[e]=0;context.putImageData(d,0,0)}),$("#AddGrayTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width(),d=context.getImageData(0,0,c,b);saveCanvasState({startX:0,startY:0,width:c,height:b});for(var e=0;e<d.data.length;e+=4)d.data[e]+=112,d.data[e+1]+=112,d.data[e+2]+=112;context.putImageData(d,0,0)}),$("#RemoveGrayTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width(),d=context.getImageData(0,0,c,b);saveCanvasState({startX:0,startY:0,width:c,height:b});for(var e=0;e<d.data.length;e+=4)d.data[e]-=112,d.data[e+1]-=112,d.data[e+2]-=112;context.putImageData(d,0,0)}),$("#AddNoiseTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width(),d=context.getImageData(0,0,c,b);saveCanvasState({startX:0,startY:0,width:c,height:b});for(var e=0;e<d.data.length;e+=4)d.data[e]+=Math.random()<.5?255*Math.random()*-1:255*Math.random(),d.data[e+1]+=Math.random()<.5?255*Math.random()*-1:255*Math.random(),d.data[e+2]+=Math.random()<.5?255*Math.random()*-1:255*Math.random();context.putImageData(d,0,0)}),$("#RandomColorTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width(),d=context.getImageData(0,0,c,b),e=Math.floor(Math.random()*c),f=Math.floor(Math.random()*b),g=d.data[e*c+f],h=d.data[e*c+f+1],i=d.data[e*c+f+2],j=Math.random()<.5?255*Math.random()*-1:255*Math.random(),k=Math.random()<.5?255*Math.random()*-1:255*Math.random(),l=Math.random()<.5?255*Math.random()*-1:255*Math.random();saveCanvasState({startX:0,startY:0,width:c,height:b});for(var m=0;m<d.data.length;m+=4)d.data[m]===g&&d.data[m+1]===h&&d.data[m+2]===i&&(d.data[m]+=j,d.data[m+1]+=k,d.data[m+2]+=l);context.putImageData(d,0,0)}),$("#FuzzyColorTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width();saveCanvasState({startX:0,startY:0,width:c,height:b});for(var d=0;255>d;d++)$("#RandomColorTool").click()}),$("#BlackAndWhiteColorTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width(),d=context.getImageData(0,0,c,b),e=0,f=0;saveCanvasState({startX:0,startY:0,width:c,height:b});for(var g=0;g<d.data.length;g+=4)e=(d.data[g]+d.data[g+1]+d.data[g+2])/3,f=112>e?0:255,d.data[g]=f,d.data[g+1]=f,d.data[g+2]=f;context.putImageData(d,0,0)}),$("#GrayColorTool").on("click",function(){var a="#"+CONSTANTS.canvasId,b=$(a).height(),c=$(a).width(),d=context.getImageData(0,0,c,b),e=0,f=0;saveCanvasState({startX:0,startY:0,width:c,height:b});for(var g=0;g<d.data.length;g+=4)e=(d.data[g]+d.data[g+1]+d.data[g+2])/3,f=16*Math.floor(e/16),d.data[g]=f,d.data[g+1]=f,d.data[g+2]=f;context.putImageData(d,0,0)})});