/*! jspaint 2015-07-04 Anubhav Saini (c) 2015 */
!function(a){"use strict";var b={canvasId:"jspaint-canvas",canvasContainerId:"jspaint-paint-area",activeToolCursorClass:"working-with-tools",maintoolsClass:"main-tool",basicColors:[{hex:"00FFFF",name:"Aqua"},{hex:"000000",name:"Black"},{hex:"0000FF",name:"Blue"},{hex:"FF00FF",name:"Fuchsia"},{hex:"808080",name:"Gray"},{hex:"008000",name:"Green"},{hex:"00FF00",name:"Lime"},{hex:"800000",name:"Maroon"},{hex:"000080",name:"Navy"},{hex:"808000",name:"Olive"},{hex:"800080",name:"Purple"},{hex:"FF0000",name:"Red"},{hex:"C0C0C0",name:"Silver"},{hex:"008080",name:"Teal"},{hex:"FFFFFF",name:"White"},{hex:"FFFF00",name:"Yellow"}],Events:{mousemove:"mousemove",mouseclick:"click"}},c=window.location.toString().split("?")[1].split("=")[1],d=c.split("x")[0],e=c.split("x")[1],f="",g="",h="white",i=null,j={Mouse:{getX:function(a){var b=a.event,c=a.relativeTo,d=b.pageX-c.offset().left;return d},getY:function(a){var b=a.event,c=a.relativeTo,d=b.pageY-c.offset().top;return d}}};a(function(){var c={fillCirc:function(a,b,c){i.beginPath(),i.arc(a,b,c,0,2*Math.PI,!1),i.fill()}},k={generateBasicColorPalette:function(c){var d=c.appendHere||".BasicColorPalette",e=a("<div></div>"),f=a("<div></div>"),g=e,h=null,i=null,j=c.basicColors||b.basicColors,k=j.length,l=0;for(l=0;k>l;l++)g=k/2>l?e:f,h="#"+j[l].hex,i=a("<div></div>").addClass("color").attr("id","Color-Hex-"+h).css("background-color",h),i.appendTo(g);e.appendTo(d),f.appendTo(d)}},l={SpeedDot:{CONSTANTS:{id:"SpeedDotTool",selectionId:"#SpeedDotTool","class":"main-tool"},VARIABLES:{width:2,height:2},start:function(c){var d=c.event||b.Events.mousemove,e="#"+(c.canvasId||b.canvasId),f=null;a(e).on(d,function(b){f={event:b,relativeTo:a(this)},i.fillRect(j.Mouse.getX(f),j.Mouse.getY(f),l.SpeedDot.VARIABLES.width,l.SpeedDot.VARIABLES.height)})},stop:function(c){var d=c.event||b.Events.mousemove,e="#"+(c.canvasId||b.canvasId);a(e).off(d)},Events:{register:function(c){var d=c.toolId||b.Tools.SpeedDot.selectionId,e=a(d);c.tool=e,e.funcToggle("click",function(){p(c),r=e},function(){r=null,q(c)})}}},Square:{CONSTANTS:{id:"SquareTool",selectionId:"#SquareTool","class":"main-tool"},VARIABLES:{side:10},start:function(c){var d=c.event||b.Events.mouseclick,e="#"+(c.canvasId||b.canvasId),f=null;a(e).on(d,function(b){f={event:b,relativeTo:a(this)},i.fillRect(j.Mouse.getX(f),j.Mouse.getY(f),l.Square.VARIABLES.side,l.Square.VARIABLES.side)})},stop:function(c){var d=c.event||b.Events.mouseclick,e="#"+(c.canvasId||b.canvasId);a(e).off(d)},Events:{register:function(c){var d=c.toolId||b.Tools.Square.selectionId,e=a(d);c.tool=e,e.funcToggle("click",function(){p(c),r=e},function(){r=null,q(c)})}}},Disc:{CONSTANTS:{id:"DiscTool",selectionId:"#DiscTool","class":"main-tool"},VARIABLES:{radius:10},start:function(d){var e=d.event||b.Events.mouseclick,f="#"+(d.canvasId||b.canvasId),g=null;a(f).on(e,function(b){g={event:b,relativeTo:a(this)},c.fillCirc(j.Mouse.getX(g),j.Mouse.getY(g),l.Disc.VARIABLES.radius)})},stop:function(c){var d=c.event||b.Events.mouseclick,e="#"+(c.canvasId||b.canvasId);a(e).off(d)},ContextMenu:{activate:function(b){var c=a("<div></div>").attr("id",b.id).addClass("menu-item"),d=a("<div></div>").attr("id",b.increaseDiscSize.id).addClass("menu-item"),e=a("<i></i>").addClass(b.increaseDiscSize.icon),f=a("<a></a>").css("font-size","20px").on("click",function(){l.Disc.VARIABLES.radius+=2,a(this).attr("title",l.Disc.VARIABLES.radius)});e.appendTo(f),f.appendTo(d);var g=a("<div></div>").attr("id",b.decreaseDiscSize.id).addClass("menu-item"),h=a("<i></i>").addClass(b.decreaseDiscSize.icon),i=a("<a></a>").css("font-size","20px").on("click",function(){l.Disc.VARIABLES.radius=l.Disc.VARIABLES.radius-2===0?2:l.Disc.VARIABLES.radius-2,a(this).attr("title",l.Disc.VARIABLES.radius)});h.appendTo(i),i.appendTo(g),d.appendTo(c),g.appendTo(c),c.appendTo(a(b.containerSelectionCriterion))},deactivate:function(b){a("#"+b.id).remove()},getOptions:function(){return{tool:this,id:"DiscContextMenu",increaseDiscSize:{id:"increaseDiscSize",icon:"glyphicon glyphicon-circle-arrow-up",containerId:"DiscContextMenu"},decreaseDiscSize:{id:"decreaseDiscSize",icon:"glyphicon glyphicon-circle-arrow-down",containerId:"DiscContextMenu"},containerSelectionCriterion:".contextual-tool-bar"}}},Events:{register:function(c){var d=c.toolId||b.Tools.Disc.selectionId,e=a(d),f=l.Disc.ContextMenu;c.tool=e,e.funcToggle("click",function(){p(c),f.activate(f.getOptions()),r=e},function(){r=null,q(c),f.deactivate(f.getOptions())})}}},Pencil:{CONSTANTS:{id:"PencilTool",selectionId:"#PencilTool","class":"main-tool"},VARIABLES:{width:2,height:2,LastPoint:{X:-1,Y:-1}},start:function(c){function d(a,b){l.Pencil.VARIABLES.LastPoint.X=a,l.Pencil.VARIABLES.LastPoint.Y=b}function e(){return{X:l.Pencil.VARIABLES.LastPoint.X,Y:l.Pencil.VARIABLES.LastPoint.Y}}function f(a,b,c,d){a.beginPath(),a.moveTo(b.X,b.Y),a.lineTo(c.X,c.Y),a.lineWidth=d,a.strokeStyle=g,a.stroke()}var h,k,m,n,o=c.event||b.Events.mousemove,p="#"+(c.canvasId||b.canvasId),q=null;a(p).on(o,function(b){q={event:b,relativeTo:a(this)},void 0!==b.buttons&&(1===b.buttons?(h=j.Mouse.getX(q),k=j.Mouse.getY(q),m=l.Pencil.VARIABLES.width,n=e(),-1!=n.X&&f(i,n,{X:h,Y:k},m),d(h,k)):(l.Pencil.VARIABLES.LastPoint.X=-1,l.Pencil.VARIABLES.LastPoint.Y=-1,i.endPath()))})},stop:function(c){var d=c.event||b.Events.mousemove,e="#"+(c.canvasId||b.canvasId);l.Pencil.VARIABLES.LastPoint.X=-1,l.Pencil.VARIABLES.LastPoint.Y=-1,a(e).off(d)},ContextMenu:{activate:function(b){var c=a("<div></div>").attr("id",b.id).addClass("menu-item"),d=a("<div></div>").attr("id",b.increaseDotSize.id).addClass("menu-item"),e=a("<i></i>").addClass(b.increaseDotSize.icon),f=a("<a></a>").css("font-size","20px").on("click",function(){l.Pencil.VARIABLES.width+=2,l.Pencil.VARIABLES.height=l.Pencil.VARIABLES.width,a(this).attr("title",l.Pencil.VARIABLES.width)});e.appendTo(f),f.appendTo(d);var g=a("<div></div>").attr("id",b.decreaseDotSize.id).addClass("menu-item"),h=a("<i></i>").addClass(b.decreaseDotSize.icon),i=a("<a></a>").css("font-size","20px").on("click",function(){l.Pencil.VARIABLES.width=l.Pencil.VARIABLES.width-2===0?2:l.Pencil.VARIABLES.width-2,l.Pencil.VARIABLES.height=l.Pencil.VARIABLES.width,a(this).attr("title",l.Pencil.VARIABLES.width)});h.appendTo(i),i.appendTo(g),d.appendTo(c),g.appendTo(c),c.appendTo(a(b.containerSelectionCriterion))},deactivate:function(b){a("#"+b.id).remove()},getOptions:function(){return{tool:this,id:"PencilContextMenu",increaseDotSize:{id:"increaseDotSize",icon:"glyphicon glyphicon-circle-arrow-up",containerId:"PencilContextMenu"},decreaseDotSize:{id:"decreaseDotSize",icon:"glyphicon glyphicon-circle-arrow-down",containerId:"PencilContextMenu"},containerSelectionCriterion:".contextual-tool-bar"}}},Events:{register:function(b){var c=b.toolId||l.Pencil.CONSTANTS.selectionId,d=a(c),e=l.Pencil.ContextMenu;b.tool=d,d.funcToggle("click",function(){p(b),e.activate(e.getOptions()),r=a(this)},function(){r=null,q(b),e.deactivate(e.getOptions())})}}}},m=function(b){var c=a("<canvas/>",{id:b.canvasId}).prop({width:b.width,height:b.height}).appendTo("#"+b.canvasContainerId);return c[0]},n=function(a){var c=a.sizeX||600,d=a.sizeY||400,e=c-2,f=d-2,g=a.canvasId||b.canvasId,h=a.canvasContainerId||b.containerId,i=m({canvasId:g,width:e,height:f,canvasContainerId:h});return i.getContext("2d")},o=function(a){return"#"+a.attr("id").split("#")[1]},p=function(b,c){null!==r&&r.trigger("click"),a(b.tool).toggleClass("active-tool"),b.start(b)},q=function(b,c){a(b.tool).toggleClass("active-tool"),b.stop(b)},r=null,s=function(){a(".color").on("click",function(){g=i.fillStyle=o(a(this))}).on("contextmenu",function(){f=o(a(this))})},t=function(b){a("#"+b.containerId+" #"+b.toolId).on("input",function(){g=i.fillStyle=a(this).val()})},u=function(c){a("#"+c.toolId).on("click",function(){window.open(a("#"+b.canvasId)[0].toDataURL("image/png"),"_blank")})},v=function(c){a("#"+c.toolId).on("click",function(){var c=a("#"+b.canvasId)[0],d=c.height,e=c.width,f=c.getContext("2d");f.save(),f.transform(1,0,0,1,0,0),f.fillStyle=h,f.fillRect(0,0,e,d),f.restore()})},w=function(){s(),l.Pencil.Events.register({toolId:l.Pencil.CONSTANTS.selectionId,event:b.Events.mousemove,canvasId:b.canvasId,start:l.Pencil.start,stop:l.Pencil.stop}),l.Disc.Events.register({toolId:l.Disc.CONSTANTS.selectionId,event:b.Events.mouseclick,canvasId:b.canvasId,start:l.Disc.start,stop:l.Disc.stop}),l.SpeedDot.Events.register({toolId:l.SpeedDot.CONSTANTS.selectionId,event:b.Events.mousemove,canvasId:b.canvasId,start:l.SpeedDot.start,stop:l.SpeedDot.stop}),l.Square.Events.register({toolId:l.Square.CONSTANTS.selectionId,containerId:"jspaint-tools",event:b.Events.mouseclick,canvasId:b.canvasId,start:l.Square.start,stop:l.Square.stop}),t({toolId:"allColorsPicker",containerId:"HTML5ColorPicker"}),u({toolId:"save-as-image",containerId:"SaveImageButton"}),v({toolId:"reset-canvas",containerId:"ResetCanvas"})},x=function(){a("#jspaint-paint-area").css({width:d,height:e})},y=function(){a("."+b.maintoolsClass).attr("title","Click to activate;\nRight-click to deactivate;")},z=function(){a(".top-taker").TopTaker({theme:"dark"})},A=function(){x(),i=n({sizeX:d,sizeY:e,canvasId:b.canvasId,canvasContainerId:b.canvasContainerId}),y(),z(),k.generateBasicColorPalette({appendHere:".BasicColorPalette",basicColors:b.basicColors}),w(),a("#PencilTool").trigger("click")},B=function(){A()};B()})}(jQuery);