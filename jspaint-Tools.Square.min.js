/*! jspaint 2015-07-15 Anubhav Saini (c) 2015 */
$(function(){"use strict";var a={CONSTANTS:{id:"SquareTool",selectionId:"#SquareTool","class":"main-tool",title:"Click to draw squares. Click again to disable.",previewId:"previewSquare"},VARIABLES:{side:10,xyPlaneRotationAngle:360},start:function(b){function c(b){$("<div></div>").attr("id",a.CONSTANTS.previewId).css({position:"fixed","z-index":"2"}).appendTo(".utilities").on("click",function(b){var c={event:b,relativeTo:$(d)},e=Actions.Mouse.getX(c),f=Actions.Mouse.getY(c),g=a.VARIABLES.side,h=a.VARIABLES.xyPlaneRotationAngle*Math.PI/180;CANVASAPI.fillRoatedSquare(e-g/2,f-g/2,g,h)}).on("mousemove",function(b){$(this).css("top",parseInt(b.pageY)-parseInt(a.VARIABLES.side/2)-parseInt(window.scrollY)).css("left",parseInt(b.pageX)-parseInt(parseInt(a.VARIABLES.side/2))-parseInt(window.scrollX)).css("background-color",selectedPrimaryColor).css("border","thin dashed "+selectedAlternativeColor).css("height",a.VARIABLES.side).css("width",a.VARIABLES.side),j=parseInt($(this).offset().left)+parseInt(a.VARIABLES.side/2),k=parseInt($(this).offset().top)+parseInt(a.VARIABLES.side/2),f=$(d).offset().left,g=$(d).offset().top,(f>j||parseInt(f+i)<j||g>k||parseInt(g+h)<k)&&$(this).hide()})}var d=(b.event||CONSTANTS.Events.mouseclick,"#"+(b.canvasId||CONSTANTS.canvasId)),e=null,f=$(d).offset().left,g=$(d).offset().top,h=$(d).height(),i=$(d).width(),j=null,k=null;c(),$(d).on("mousemove",function(b){e=e||$("#"+a.CONSTANTS.previewId),e.css("top",b.pageY-parseInt(a.VARIABLES.side/2)-window.scrollY).css("left",b.pageX-parseInt(a.VARIABLES.side/2)-window.scrollX).css("background-color",selectedPrimaryColor).css("height",a.VARIABLES.side).css("width",a.VARIABLES.side).css("transform","rotate("+parseInt(a.VARIABLES.xyPlaneRotationAngle*Math.PI)/180+"rad)").show()})},stop:function(a){var b=a.event||CONSTANTS.Events.mouseclick,c="#"+(a.canvasId||CONSTANTS.canvasId);$(c).off(b)},ContextMenu:{activate:function(b){function c(a,b,c){return $('<input id="'+a+'" type="range" min="1" max="'+c+'" step="1" title="'+b+'" />')}function d(a){var b=$("#"+a.id);return 0===b.length?$("<div></div>").attr("id",a.id).addClass("menu-item"):b}function e(b){return c("sideSquare","side length for square tool",200).attr("value",a.VARIABLES.side).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){a.VARIABLES.side=$(this).val()})}function f(b){return c("xyPlaneRotationAngle","rotation angle for XY plane rotation.",360).attr("value",a.VARIABLES.xyPlaneRotationAngle).on("mouseover",function(){$(this).attr("title",$(this).val()+" deg")}).on("input",function(){a.VARIABLES.xyPlaneRotationAngle=$(this).val()})}var g=d(b);e(b).appendTo(g),f(b).appendTo(g),g.appendTo($(b.containerSelectionCriterion))},deactivate:function(b){function c(a){$("#"+a.id).remove()}c(b),$("#"+a.CONSTANTS.previewId).off("mousemove"),$("#"+a.CONSTANTS.previewId).remove()},getOptions:function(){return{tool:this,id:"SquareToolContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}},Events:{register:function(b){var c=b.toolId,d=$(c),e=a.ContextMenu;setupToolTips(d,a.CONSTANTS.title),b.tool=d,d.funcToggle("click",function(){activateTool(b),e.activate(e.getOptions())},function(){e.deactivate(e.getOptions()),deactivateTool(b)})}}};a.Events.register({toolId:a.CONSTANTS.selectionId,event:CONSTANTS.Events.mouseclick,canvasId:CONSTANTS.canvasId,start:a.start,stop:a.stop,toolName:"Square"})});