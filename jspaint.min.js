/*! jspaint 2015-07-06 Anubhav Saini (c) 2015 */
!function(a){"use strict";function b(a,b){a.attr("title",b).attr("data-toggle","tooltip").attr("data-placement","bottom")}var c={canvasId:"jspaint-canvas",canvasContainerId:"jspaint-paint-area",activeToolCursorClass:"working-with-tools",maintoolsClass:"main-tool",basicColors:[{hex:"00FFFF",name:"Aqua"},{hex:"000000",name:"Black"},{hex:"0000FF",name:"Blue"},{hex:"FF00FF",name:"Fuchsia"},{hex:"808080",name:"Gray"},{hex:"008000",name:"Green"},{hex:"00FF00",name:"Lime"},{hex:"800000",name:"Maroon"},{hex:"000080",name:"Navy"},{hex:"808000",name:"Olive"},{hex:"800080",name:"Purple"},{hex:"FF0000",name:"Red"},{hex:"C0C0C0",name:"Silver"},{hex:"008080",name:"Teal"},{hex:"FFFFFF",name:"White"},{hex:"FFFF00",name:"Yellow"}],Events:{mousemove:"mousemove",mouseclick:"click"}},d=window.location.toString().split("?")[1].split("=")[1],e=d.split("x")[0],f=d.split("x")[1],g="",h="",i="white",j=null,k={Mouse:{getX:function(a){var b=a.event,c=a.relativeTo,d=b.pageX-c.offset().left;return d},getY:function(a){var b=a.event,c=a.relativeTo,d=b.pageY-c.offset().top;return d}}};a(function(){var d={fillCirc:function(a,b,c){j.beginPath(),j.arc(a,b,c,0,2*Math.PI,!1),j.fill()},fillSquare:function(a,b,c){j.fillRect(a,b,c,c)},fillRing:function(a){d.fillCirc(a.X,a.Y,a.outerRadius),j.save(),j.fillStyle=i,d.fillCirc(a.X,a.Y,a.innerRadius),j.restore()}},l={generateBasicColorPalette:function(b){var d=b.appendHere||".BasicColorPalette",e=a("<div></div>"),f=a("<div></div>"),g=e,h=null,i=null,j=b.basicColors||c.basicColors,k=j.length,l=0;for(l=0;k>l;l++)g=k/2>l?e:f,h="#"+j[l].hex,i=a("<div></div>").addClass("color").attr("id","Color-Hex-"+h).css("background-color",h),i.appendTo(g);e.appendTo(d),f.appendTo(d)}},m={SpeedDot:{CONSTANTS:{id:"SpeedDotTool",selectionId:"#SpeedDotTool","class":"main-tool",title:"Click to draw circles of fixed radius on draw area using mouse movement. Click again to disable."},VARIABLES:{radius:4},start:function(b){var e=b.event||c.Events.mousemove,f="#"+(b.canvasId||c.canvasId),g=null,h=null,i=null,j=null;a(f).on(e,function(b){g={event:b,relativeTo:a(this)},h=k.Mouse.getX(g),i=k.Mouse.getY(g),j=m.SpeedDot.VARIABLES.radius,d.fillCirc(h,i,j)})},stop:function(b){var d=b.event||c.Events.mousemove,e="#"+(b.canvasId||c.canvasId);a(e).off(d)},ContextMenu:{activate:function(b){function c(){return a('<input id="radiusSpeedDot" type="range" min="1" max="50" step="1" title="radius for speed dot tool" />')}function d(b){var d=a("<div></div>").attr("id",b.id).addClass("menu-item"),f=c().attr("value",e.radius).on("mouseover",function(){a(this).attr("title",a(this).val())}).on("input",function(){e.radius=a(this).val()});f.appendTo(d),d.appendTo(a(b.containerSelectionCriterion))}var e=m.SpeedDot.VARIABLES;d(b)},deactivate:function(b){function c(b){a("#"+b.id).remove()}c(b)},getOptions:function(){return{tool:this,id:"SpeedDotContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}},Events:{register:function(d){var e=d.toolId||c.Tools.SpeedDot.selectionId,f=a(e),g=m.SpeedDot.ContextMenu;b(f,m.SpeedDot.CONSTANTS.title),d.tool=f,f.funcToggle("click",function(){q(d),g.activate(g.getOptions()),s=f},function(){s=null,r(d),g.deactivate(g.getOptions())})}}},Square:{CONSTANTS:{id:"SquareTool",selectionId:"#SquareTool","class":"main-tool",title:"Click to draw squares of fixed side on draw area using click. Click again to disable."},VARIABLES:{side:10},start:function(b){var e=b.event||c.Events.mouseclick,f="#"+(b.canvasId||c.canvasId),g=null,h=null,i=null,j=null;a(f).on(e,function(b){g={event:b,relativeTo:a(this)},h=k.Mouse.getX(g),i=k.Mouse.getY(g),j=m.Square.VARIABLES.side,d.fillSquare(h,i,j)})},stop:function(b){var d=b.event||c.Events.mouseclick,e="#"+(b.canvasId||c.canvasId);a(e).off(d)},ContextMenu:{activate:function(b){function c(){return a('<input id="sideSquare" type="range" min="1" max="200" step="1" title="side length for square tool" />')}function d(b){var d=a("<div></div>").attr("id",b.id).addClass("menu-item"),e=c().attr("value",m.Square.VARIABLES.side).on("mouseover",function(){a(this).attr("title",a(this).val())}).on("input",function(){m.Square.VARIABLES.side=a(this).val()});e.appendTo(d),d.appendTo(a(b.containerSelectionCriterion))}d(b)},deactivate:function(b){function c(b){a("#"+b.id).remove()}c(b)},getOptions:function(){return{tool:this,id:"SquareToolContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}},Events:{register:function(d){var e=d.toolId||c.Tools.Square.selectionId,f=a(e),g=m.Square.ContextMenu;b(f,m.Square.CONSTANTS.title),d.tool=f,f.funcToggle("click",function(){q(d),g.activate(g.getOptions()),s=f},function(){s=null,g.deactivate(g.getOptions()),r(d)})}}},Disc:{CONSTANTS:{id:"DiscTool",selectionId:"#DiscTool","class":"main-tool",title:"Click to draw disc of fixed radius on draw area using click. Click again to disable."},VARIABLES:{radius:10},start:function(b){var e=b.event||c.Events.mouseclick,f="#"+(b.canvasId||c.canvasId),g=null,h=null,i=null,j=null;a(f).on(e,function(b){g={event:b,relativeTo:a(this)},h=k.Mouse.getX(g),i=k.Mouse.getY(g),j=m.Disc.VARIABLES.radius,d.fillCirc(h,i,j)})},stop:function(b){var d=b.event||c.Events.mouseclick,e="#"+(b.canvasId||c.canvasId);a(e).off(d)},ContextMenu:{activate:function(b){function c(){return a('<input id="radiusDisc" type="range" min="1" max="200" step="1" title="radius for disc tool." />')}function d(b){var d=a("<div></div>").attr("id",b.id).addClass("menu-item"),e=c().attr("value",m.Disc.VARIABLES.radius).on("mouseover",function(){a(this).attr("title",a(this).val())}).on("input",function(){m.Disc.VARIABLES.radius=a(this).val()});e.appendTo(d),d.appendTo(a(b.containerSelectionCriterion))}d(b)},deactivate:function(b){function c(b){a("#"+b.id).remove()}c(b)},getOptions:function(){return{tool:this,id:"DiscContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}},Events:{register:function(d){var e=d.toolId||c.Tools.Disc.selectionId,f=a(e),g=m.Disc.ContextMenu;b(f,m.Disc.CONSTANTS.title),d.tool=f,f.funcToggle("click",function(){q(d),g.activate(g.getOptions()),s=f},function(){s=null,r(d),g.deactivate(g.getOptions())})}}},Pencil:{CONSTANTS:{id:"PencilTool",selectionId:"#PencilTool","class":"main-tool",title:"Click to draw free hand lines of fixed width on draw area using click+drag. Click again to disable."},VARIABLES:{width:2,height:2,LastPoint:{X:-1,Y:-1}},start:function(b){function e(a,b){m.Pencil.VARIABLES.LastPoint.X=a,m.Pencil.VARIABLES.LastPoint.Y=b}function f(){return{X:m.Pencil.VARIABLES.LastPoint.X,Y:m.Pencil.VARIABLES.LastPoint.Y}}function g(a){var b=a.context,c=a.last,d=a.current,e=a.width;b.beginPath(),b.moveTo(c.X,c.Y),b.lineTo(d.X,d.Y),b.lineWidth=e,b.strokeStyle=h,b.stroke()}var i=b.event||c.Events.mousemove,l="#"+(b.canvasId||c.canvasId),n=null,o=null,p=null,q=null,r=null;a(l).on(i,function(b){n={event:b,relativeTo:a(this)},void 0!==b.buttons&&(1===b.buttons?(o=k.Mouse.getX(n),p=k.Mouse.getY(n),q=m.Pencil.VARIABLES.width,r=f(),-1!=r.X&&g({context:j,last:r,current:{X:o,Y:p},width:q}),d.fillCirc(o,p,q/2),e(o,p)):(m.Pencil.VARIABLES.LastPoint.X=-1,m.Pencil.VARIABLES.LastPoint.Y=-1))})},stop:function(b){var d=b.event||c.Events.mousemove,e="#"+(b.canvasId||c.canvasId);m.Pencil.VARIABLES.LastPoint.X=-1,m.Pencil.VARIABLES.LastPoint.Y=-1,a(e).off(d)},ContextMenu:{activate:function(b){function c(){return a('<input id="widthPencil" type="range" min="1" max="100" step="1" title="width for pencil tool." />')}function d(b){var d=a("<div></div>").attr("id",b.id).addClass("menu-item"),e=c().attr("value",m.Pencil.VARIABLES.width).on("mouseover",function(){a(this).attr("title",a(this).val())}).on("input",function(){m.Pencil.VARIABLES.width=a(this).val()});e.appendTo(d),d.appendTo(a(b.containerSelectionCriterion))}d(b)},deactivate:function(b){function c(b){a("#"+b.id).remove()}c(b)},getOptions:function(){return{tool:this,id:"PencilContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}},Events:{register:function(c){var d=c.toolId||m.Pencil.CONSTANTS.selectionId,e=a(d),f=m.Pencil.ContextMenu;b(e,m.Pencil.CONSTANTS.title),c.tool=e,e.funcToggle("click",function(){q(c),f.activate(f.getOptions()),s=a(this)},function(){s=null,r(c),f.deactivate(f.getOptions())})}}},PickColor:{CONSTANTS:{id:"pick-color",selectionId:"#pick-color","class":"string-menu-item",containerId:"PickColorTool",title:"Click to pick color under mouse pointer tip from draw area using click; picks until some other tool is selected. Click again to disable."},start:function(b){var d=b.event||c.Events.mouseclick,e="#"+(b.canvasId||c.canvasId),f=null,g=null,i=null,l=null,m=0,n=0,o=0,p=0;a(e).on(d,function(b){f={event:b,relativeTo:a(this)},g=k.Mouse.getX(f),i=k.Mouse.getY(f),l=j.getImageData(g-.5,i-.5,g+.5,i+.5).data,m=l[0],n=l[1],o=l[2],p=l[3],h=j.fillStyle="rgba("+m+", "+n+", "+o+", "+p+")"})},stop:function(b){var d=b.event||c.Events.mouseclick,e="#"+(b.canvasId||c.canvasId);a(e).off(d)},Events:{register:function(c){var d=c.toolId||Tool.PickColor.CONSTANTS.selectionId,e=a(d);b(e,m.PickColor.CONSTANTS.title),c.tool=e,e.funcToggle("click",function(){q(c),s=a(this)},function(){s=null,r(c)})}}},Ring:{CONSTANTS:{id:"RingTool",selectionId:"#RingTool","class":"main-tool",title:"Click to draw ring. Click again to disable."},VARIABLES:{innerRadius:10,outerRadius:20},start:function(b){var e=b.event||c.Events.mouseclick,f="#"+(b.canvasId||c.canvasId),g=null,h=null,i=null,j=null,l=null;a(f).on(e,function(b){g={event:b,relativeTo:a(this)},h=k.Mouse.getX(g),i=k.Mouse.getY(g),j=m.Ring.VARIABLES.innerRadius,l=m.Ring.VARIABLES.outerRadius,d.fillRing({X:h,Y:i,innerRadius:j,outerRadius:l})})},stop:function(b){var d=b.event||c.Events.mouseclick,e="#"+(b.canvasId||c.canvasId);a(e).off(d)},ContextMenu:{activate:function(b){function c(b,c){return a('<input id="'+b+'" type="range" min="1" max="200" step="1" title="'+c+'" />')}function d(b){var d=a("<div></div>").attr("id",b.id).addClass("menu-item"),e=c("innerRadiusRing","inner radius for ring tool.").attr("value",m.Ring.VARIABLES.innerRadius).on("mouseover",function(){a(this).attr("title",a(this).val())}).on("input",function(){m.Ring.VARIABLES.innerRadius=a(this).val()}),f=c("outerRadiusRing","outer radius for ring tool.").attr("value",m.Ring.VARIABLES.outerRadius).on("mouseover",function(){a(this).attr("title",a(this).val())}).on("input",function(){m.Ring.VARIABLES.outerRadius=a(this).val()});f.appendTo(d),e.appendTo(d),d.appendTo(a(b.containerSelectionCriterion))}d(b)},deactivate:function(b){function c(b){a("#"+b.id).remove()}c(b)},getOptions:function(){return{tool:this,id:"RingContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}},Events:{register:function(c){var d=c.toolId||m.Ring.CONSTANTS.selectionId,e=a(d),f=m.Ring.ContextMenu;b(e,m.Ring.CONSTANTS.title),c.tool=e,e.funcToggle("click",function(){q(c),f.activate(f.getOptions()),s=e},function(){s=null,r(c),f.deactivate(f.getOptions())})}}}},n=function(b){var c=a("<canvas/>",{id:b.canvasId}).prop({width:b.width,height:b.height}).appendTo("#"+b.canvasContainerId);return c[0]},o=function(a){var b=a.sizeX||600,c=a.sizeY||400,d=b-2,e=c-2,f=null;return a.width=d,a.height=e,f=n(a),f.getContext("2d")},p=function(a){return"#"+a.attr("id").split("#")[1]},q=function(b){null!==s&&s.trigger("click"),a(b.tool).toggleClass("active-tool"),b.start(b)},r=function(b){a(b.tool).toggleClass("active-tool"),b.stop(b)},s=null,t=function(){a(".color").on("click",function(){h=j.fillStyle=p(a(this))}).on("contextmenu",function(){g=p(a(this))})},u=function(b){a("#"+b.containerId+" #"+b.toolId).on("input",function(){h=j.fillStyle=a(this).val()})},v=function(b){a("#"+b.toolId).on("click",function(){window.open(a("#"+c.canvasId)[0].toDataURL("image/png"),"_blank")})},w=function(b){a("#"+b.toolId).on("click",function(){var b=a("#"+c.canvasId)[0],d=b.height,e=b.width,f=b.getContext("2d");f.save(),f.transform(1,0,0,1,0,0),f.fillStyle=i,f.fillRect(0,0,e,d),f.restore()})},x=function(){t(),m.Pencil.Events.register({toolId:m.Pencil.CONSTANTS.selectionId,event:c.Events.mousemove,canvasId:c.canvasId,start:m.Pencil.start,stop:m.Pencil.stop}),m.Disc.Events.register({toolId:m.Disc.CONSTANTS.selectionId,event:c.Events.mouseclick,canvasId:c.canvasId,start:m.Disc.start,stop:m.Disc.stop}),m.SpeedDot.Events.register({toolId:m.SpeedDot.CONSTANTS.selectionId,event:c.Events.mousemove,canvasId:c.canvasId,start:m.SpeedDot.start,stop:m.SpeedDot.stop}),m.Square.Events.register({toolId:m.Square.CONSTANTS.selectionId,containerId:"jspaint-tools",event:c.Events.mouseclick,canvasId:c.canvasId,start:m.Square.start,stop:m.Square.stop}),m.PickColor.Events.register({toolId:m.PickColor.CONSTANTS.selectionId,containerId:m.PickColor.CONSTANTS.containerId,event:c.Events.mouseclick,canvasId:c.canvasId,start:m.PickColor.start,stop:m.PickColor.stop}),m.Ring.Events.register({toolId:m.Ring.CONSTANTS.selectionId,event:c.Events.mouseclick,canvasId:c.canvasId,start:m.Ring.start,stop:m.Ring.stop}),u({toolId:"allColorsPicker",containerId:"HTML5ColorPicker"}),v({toolId:"save-as-image",containerId:"SaveImageButton"}),w({toolId:"reset-canvas",containerId:"ResetCanvas"})},y=function(){a("#jspaint-paint-area").css({width:e,height:f})},z=function(){a(".top-taker").TopTaker({theme:"dark"})},A=function(){y(),j=o({sizeX:e,sizeY:f,canvasId:c.canvasId,canvasContainerId:c.canvasContainerId}),z(),l.generateBasicColorPalette({appendHere:".BasicColorPalette",basicColors:c.basicColors}),x(),a("#PencilTool").trigger("click"),a('[data-toggle="tooltip"]').tooltip()};A()})}(jQuery);