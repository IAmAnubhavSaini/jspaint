/*! jspaint 2015-07-06 Anubhav Saini (c) 2015 */
$(function(){"use strict";var a={CONSTANTS:{id:"PivotedLinePatternTool",selectionId:"#PivotedLinePatternTool","class":"main-tool",title:"Click to draw free hand lines of fixed width on draw area using click+drag. Click again to disable."},VARIABLES:{width:2,height:2,LastPoint:{X:-1,Y:-1}},start:function(b){function c(b,c){a.VARIABLES.LastPoint.X=b,a.VARIABLES.LastPoint.Y=c}function d(){return{X:a.VARIABLES.LastPoint.X,Y:a.VARIABLES.LastPoint.Y}}function e(a){var b=a.context,c=a.last,d=a.current,e=a.width;b.beginPath(),b.moveTo(c.X,c.Y),b.lineTo(d.X,d.Y),b.lineWidth=e,b.strokeStyle=selectedPrimaryColor,b.stroke(),b.endPath()}var f=b.event||CONSTANTS.Events.mousemove,g="#"+(b.canvasId||CONSTANTS.canvasId),h=null,i=null,j=null,k=null,l=null;$(g).on(f,function(b){h={event:b,relativeTo:$(this)},void 0!==b.buttons&&(1===b.buttons?(i=Actions.Mouse.getX(h),j=Actions.Mouse.getY(h),k=a.VARIABLES.width,l=d(),-1!=l.X&&e({context:context,last:l,current:{X:i,Y:j},width:k}),CANVASAPI.fillCirc(i,j,k/2),c(i,j)):(a.VARIABLES.LastPoint.X=-1,a.VARIABLES.LastPoint.Y=-1))})},stop:function(b){var c=b.event||CONSTANTS.Events.mousemove,d="#"+(b.canvasId||CONSTANTS.canvasId);a.VARIABLES.LastPoint.X=-1,a.VARIABLES.LastPoint.Y=-1,$(d).off(c)},ContextMenu:{activate:function(b){function c(){return $('<input id="widthPivotedLinePattern" type="range" min="1" max="100" step="1" title="width for pivoted line pattern tool." />')}function d(b){var d=$("<div></div>").attr("id",b.id).addClass("menu-item"),e=c().attr("value",a.VARIABLES.width).on("mouseover",function(){$(this).attr("title",$(this).val())}).on("input",function(){a.VARIABLES.width=$(this).val()});e.appendTo(d),d.appendTo($(b.containerSelectionCriterion))}d(b)},deactivate:function(a){function b(a){$("#"+a.id).remove()}b(a)},getOptions:function(){return{tool:this,id:"PivotedLinePatternContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}},Events:{register:function(b){var c=b.toolId||a.CONSTANTS.selectionId,d=$(c),e=a.ContextMenu;setupToolTips(d,a.CONSTANTS.title),b.tool=d,d.funcToggle("click",function(){activateTool(b),e.activate(e.getOptions()),activeTool=$(this)},function(){activeTool=null,deactivateTool(b),e.deactivate(e.getOptions())})}}};a.Events.register({toolId:a.CONSTANTS.selectionId,event:CONSTANTS.Events.mousemove,canvasId:CONSTANTS.canvasId,start:a.start,stop:a.stop})});