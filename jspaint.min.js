/*! jspaint 2015-07-05 Anubhav Saini (c) 2015 */
!function(a){"use strict";var b={canvasId:"jspaint-canvas",canvasContainerId:"jspaint-paint-area",activeToolCursorClass:"working-with-tools",maintoolsClass:"main-tool",basicColors:[{hex:"00FFFF",name:"Aqua"},{hex:"000000",name:"Black"},{hex:"0000FF",name:"Blue"},{hex:"FF00FF",name:"Fuchsia"},{hex:"808080",name:"Gray"},{hex:"008000",name:"Green"},{hex:"00FF00",name:"Lime"},{hex:"800000",name:"Maroon"},{hex:"000080",name:"Navy"},{hex:"808000",name:"Olive"},{hex:"800080",name:"Purple"},{hex:"FF0000",name:"Red"},{hex:"C0C0C0",name:"Silver"},{hex:"008080",name:"Teal"},{hex:"FFFFFF",name:"White"},{hex:"FFFF00",name:"Yellow"}],Events:{mousemove:"mousemove",mouseclick:"click"}},c=window.location.toString().split("?")[1].split("=")[1],d=c.split("x")[0],e=c.split("x")[1],f="",g="",h="white",i=null,j={Mouse:{getX:function(a){var b=a.event,c=a.relativeTo,d=b.pageX-c.offset().left;return d},getY:function(a){var b=a.event,c=a.relativeTo,d=b.pageY-c.offset().top;return d}}};a(function(){var c={fillCirc:function(a,b,c){i.beginPath(),i.arc(a,b,c,0,2*Math.PI,!1),i.fill()},fillSquare:function(a,b,c){i.fillRect(a,b,c,c)}},k={generateBasicColorPalette:function(c){var d=c.appendHere||".BasicColorPalette",e=a("<div></div>"),f=a("<div></div>"),g=e,h=null,i=null,j=c.basicColors||b.basicColors,k=j.length,l=0;for(l=0;k>l;l++)g=k/2>l?e:f,h="#"+j[l].hex,i=a("<div></div>").addClass("color").attr("id","Color-Hex-"+h).css("background-color",h),i.appendTo(g);e.appendTo(d),f.appendTo(d)}},l={SpeedDot:{CONSTANTS:{id:"SpeedDotTool",selectionId:"#SpeedDotTool","class":"main-tool"},VARIABLES:{radius:4},start:function(d){var e=d.event||b.Events.mousemove,f="#"+(d.canvasId||b.canvasId),g=null,h=null,i=null,k=null;a(f).on(e,function(b){g={event:b,relativeTo:a(this)},h=j.Mouse.getX(g),i=j.Mouse.getY(g),k=l.SpeedDot.VARIABLES.radius,c.fillCirc(h,i,k)})},stop:function(c){var d=c.event||b.Events.mousemove,e="#"+(c.canvasId||b.canvasId);a(e).off(d)},ContextMenu:{activate:function(b){function c(){return a('<input id="radiusSpeedDot" type="range" min="1" max="50" step="1" title="radius for speed dot tool" />')}function d(b){var d=a("<div></div>").attr("id",b.id).addClass("menu-item"),f=c().attr("value",e.radius).on("mouseover",function(){a(this).attr("title",a(this).val())}).on("input",function(){e.radius=a(this).val()});f.appendTo(d),d.appendTo(a(b.containerSelectionCriterion))}var e=l.SpeedDot.VARIABLES;d(b)},deactivate:function(b){function c(b){a("#"+b.id).remove()}c(b)},getOptions:function(){return{tool:this,id:"SpeedDotContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}},Events:{register:function(c){var d=c.toolId||b.Tools.SpeedDot.selectionId,e=a(d),f=l.SpeedDot.ContextMenu;c.tool=e,e.funcToggle("click",function(){p(c),f.activate(f.getOptions()),r=e},function(){r=null,q(c),f.deactivate(f.getOptions())})}}},Square:{CONSTANTS:{id:"SquareTool",selectionId:"#SquareTool","class":"main-tool"},VARIABLES:{side:10},start:function(d){var e=d.event||b.Events.mouseclick,f="#"+(d.canvasId||b.canvasId),g=null,h=null,i=null,k=null;a(f).on(e,function(b){g={event:b,relativeTo:a(this)},h=j.Mouse.getX(g),i=j.Mouse.getY(g),k=l.Square.VARIABLES.side,c.fillSquare(h,i,k)})},stop:function(c){var d=c.event||b.Events.mouseclick,e="#"+(c.canvasId||b.canvasId);a(e).off(d)},ContextMenu:{activate:function(b){function c(){return a('<input id="sideSquare" type="range" min="1" max="200" step="1" title="side length for square tool" />')}function d(b){var d=a("<div></div>").attr("id",b.id).addClass("menu-item"),e=c().attr("value",l.Square.VARIABLES.side).on("mouseover",function(){a(this).attr("title",a(this).val())}).on("input",function(){l.Square.VARIABLES.side=a(this).val()});e.appendTo(d),d.appendTo(a(b.containerSelectionCriterion))}d(b)},deactivate:function(b){function c(b){a("#"+b.id).remove()}c(b)},getOptions:function(){return{tool:this,id:"SquareToolContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}},Events:{register:function(c){var d=c.toolId||b.Tools.Square.selectionId,e=a(d),f=l.Square.ContextMenu;c.tool=e,e.funcToggle("click",function(){p(c),f.activate(f.getOptions()),r=e},function(){r=null,f.deactivate(f.getOptions()),q(c)})}}},Disc:{CONSTANTS:{id:"DiscTool",selectionId:"#DiscTool","class":"main-tool"},VARIABLES:{radius:10},start:function(d){var e=d.event||b.Events.mouseclick,f="#"+(d.canvasId||b.canvasId),g=null,h=null,i=null,k=null;a(f).on(e,function(b){g={event:b,relativeTo:a(this)},h=j.Mouse.getX(g),i=j.Mouse.getY(g),k=l.Disc.VARIABLES.radius,c.fillCirc(h,i,k)})},stop:function(c){var d=c.event||b.Events.mouseclick,e="#"+(c.canvasId||b.canvasId);a(e).off(d)},ContextMenu:{activate:function(b){function c(){return a('<input id="radiusDisc" type="range" min="1" max="200" step="1" title="radius for disc tool." />')}function d(b){var d=a("<div></div>").attr("id",b.id).addClass("menu-item"),e=c().attr("value",l.Disc.VARIABLES.radius).on("mouseover",function(){a(this).attr("title",a(this).val())}).on("input",function(){l.Disc.VARIABLES.radius=a(this).val()});e.appendTo(d),d.appendTo(a(b.containerSelectionCriterion))}d(b)},deactivate:function(b){function c(b){a("#"+b.id).remove()}c(b)},getOptions:function(){return{tool:this,id:"DiscContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}},Events:{register:function(c){var d=c.toolId||b.Tools.Disc.selectionId,e=a(d),f=l.Disc.ContextMenu;c.tool=e,e.funcToggle("click",function(){p(c),f.activate(f.getOptions()),r=e},function(){r=null,q(c),f.deactivate(f.getOptions())})}}},Pencil:{CONSTANTS:{id:"PencilTool",selectionId:"#PencilTool","class":"main-tool"},VARIABLES:{width:2,height:2,LastPoint:{X:-1,Y:-1}},start:function(d){function e(a,b){l.Pencil.VARIABLES.LastPoint.X=a,l.Pencil.VARIABLES.LastPoint.Y=b}function f(){return{X:l.Pencil.VARIABLES.LastPoint.X,Y:l.Pencil.VARIABLES.LastPoint.Y}}function h(a){var b=a.context,c=a.last,d=a.current,e=a.width;b.beginPath(),b.moveTo(c.X,c.Y),b.lineTo(d.X,d.Y),b.lineWidth=e,b.strokeStyle=g,b.stroke()}var k=d.event||b.Events.mousemove,m="#"+(d.canvasId||b.canvasId),n=null,o=null,p=null,q=null,r=null;a(m).on(k,function(b){n={event:b,relativeTo:a(this)},void 0!==b.buttons&&(1===b.buttons?(o=j.Mouse.getX(n),p=j.Mouse.getY(n),q=l.Pencil.VARIABLES.width,r=f(),-1!=r.X&&h({context:i,last:r,current:{X:o,Y:p},width:q}),c.fillCirc(o,p,q/2),e(o,p)):(l.Pencil.VARIABLES.LastPoint.X=-1,l.Pencil.VARIABLES.LastPoint.Y=-1))})},stop:function(c){var d=c.event||b.Events.mousemove,e="#"+(c.canvasId||b.canvasId);l.Pencil.VARIABLES.LastPoint.X=-1,l.Pencil.VARIABLES.LastPoint.Y=-1,a(e).off(d)},ContextMenu:{activate:function(b){function c(){return a('<input id="radiusDisc" type="range" min="1" max="100" step="1" title="width for pencil tool." />')}function d(b){var d=a("<div></div>").attr("id",b.id).addClass("menu-item"),e=c().attr("value",l.Pencil.VARIABLES.width).on("mouseover",function(){a(this).attr("title",a(this).val())}).on("input",function(){l.Pencil.VARIABLES.width=a(this).val()});e.appendTo(d),d.appendTo(a(b.containerSelectionCriterion))}d(b)},deactivate:function(b){function c(b){a("#"+b.id).remove()}c(b)},getOptions:function(){return{tool:this,id:"PencilContextMenu",containerSelectionCriterion:".contextual-tool-bar"}}},Events:{register:function(b){var c=b.toolId||l.Pencil.CONSTANTS.selectionId,d=a(c),e=l.Pencil.ContextMenu;b.tool=d,d.funcToggle("click",function(){p(b),e.activate(e.getOptions()),r=a(this)},function(){r=null,q(b),e.deactivate(e.getOptions())})}}}},m=function(b){var c=a("<canvas/>",{id:b.canvasId}).prop({width:b.width,height:b.height}).appendTo("#"+b.canvasContainerId);return c[0]},n=function(a){var b=a.sizeX||600,c=a.sizeY||400,d=b-2,e=c-2,f=null;return a.width=d,a.height=e,f=m(a),f.getContext("2d")},o=function(a){return"#"+a.attr("id").split("#")[1]},p=function(b,c){null!==r&&r.trigger("click"),a(b.tool).toggleClass("active-tool"),b.start(b)},q=function(b,c){a(b.tool).toggleClass("active-tool"),b.stop(b)},r=null,s=function(){a(".color").on("click",function(){g=i.fillStyle=o(a(this))}).on("contextmenu",function(){f=o(a(this))})},t=function(b){a("#"+b.containerId+" #"+b.toolId).on("input",function(){g=i.fillStyle=a(this).val()})},u=function(c){a("#"+c.toolId).on("click",function(){window.open(a("#"+b.canvasId)[0].toDataURL("image/png"),"_blank")})},v=function(c){a("#"+c.toolId).on("click",function(){var c=a("#"+b.canvasId)[0],d=c.height,e=c.width,f=c.getContext("2d");f.save(),f.transform(1,0,0,1,0,0),f.fillStyle=h,f.fillRect(0,0,e,d),f.restore()})},w=function(){s(),l.Pencil.Events.register({toolId:l.Pencil.CONSTANTS.selectionId,event:b.Events.mousemove,canvasId:b.canvasId,start:l.Pencil.start,stop:l.Pencil.stop}),l.Disc.Events.register({toolId:l.Disc.CONSTANTS.selectionId,event:b.Events.mouseclick,canvasId:b.canvasId,start:l.Disc.start,stop:l.Disc.stop}),l.SpeedDot.Events.register({toolId:l.SpeedDot.CONSTANTS.selectionId,event:b.Events.mousemove,canvasId:b.canvasId,start:l.SpeedDot.start,stop:l.SpeedDot.stop}),l.Square.Events.register({toolId:l.Square.CONSTANTS.selectionId,containerId:"jspaint-tools",event:b.Events.mouseclick,canvasId:b.canvasId,start:l.Square.start,stop:l.Square.stop}),t({toolId:"allColorsPicker",containerId:"HTML5ColorPicker"}),u({toolId:"save-as-image",containerId:"SaveImageButton"}),v({toolId:"reset-canvas",containerId:"ResetCanvas"})},x=function(){a("#jspaint-paint-area").css({width:d,height:e})},y=function(){a(".top-taker").TopTaker({theme:"dark"})},z=function(){x(),i=n({sizeX:d,sizeY:e,canvasId:b.canvasId,canvasContainerId:b.canvasContainerId}),y(),k.generateBasicColorPalette({appendHere:".BasicColorPalette",basicColors:b.basicColors}),w(),a("#PencilTool").trigger("click")};z()})}(jQuery);