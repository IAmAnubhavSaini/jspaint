/*! jspaint 2015-07-01 Anubhav Saini (c) 2015 */
!function(a){"use strict";a(function(){var b={canvasId:"jspaint-canvas",containerId:"jspaint-paint-area",activeToolCursorClass:"working-with-tools",maintoolsClass:"main-tool",basicColors:[{id:"00FFFF",name:"Aqua"},{id:"000000",name:"Black"},{id:"0000FF",name:"Blue"},{id:"FF00FF",name:"Fuchsia"},{id:"808080",name:"Gray"},{id:"008000",name:"Green"},{id:"00FF00",name:"Lime"},{id:"800000",name:"Maroon"},{id:"000080",name:"Navy"},{id:"808000",name:"Olive"},{id:"800080",name:"Purple"},{id:"FF0000",name:"Red"},{id:"C0C0C0",name:"Silver"},{id:"008080",name:"Teal"},{id:"FFFFFF",name:"White"},{id:"FFFF00",name:"Yellow"}]},c=window.location.toString().split("?")[1].split("=")[1],d=c.split("x")[0],e=c.split("x")[1],f="",g="",h="white",i=null,j=function(){for(var c=a("<div></div>"),d=a("<div></div>"),e=c,f=0,g=b.basicColors.length;g>f;f++){e=g/2>f?c:d;var h="#"+b.basicColors[f].id,i=a('<div class="color" id="Color-Hex-'+h+'" style="background-color: '+h+';"></div>');i.appendTo(e)}c.appendTo(".BasicColorPalette"),d.appendTo(".BasicColorPalette")},k=function(){var c=d-2,f=e-2;return a("<canvas/>",{id:b.canvasId}).prop({width:c,height:f}).appendTo("#"+b.containerId),a("#"+b.canvasId)[0].getContext("2d")},l=function(){a("#"+b.canvasId).on("mousemove",function(b){i.fillRect(b.pageX-a(this).offset().left,b.pageY-a(this).offset().top,2,2)})},m=function(){a("#"+b.canvasId).off("mousemove")},n={fillCirc:function(a,b,c){i.beginPath(),i.arc(a,b,c,0,2*Math.PI,!1),i.fill()}},o=function(){a("#"+b.canvasId).on("click",function(b){n.fillCirc(b.pageX-a(this).offset().left,b.pageY-a(this).offset().top,4)})},p=function(){a("#"+b.canvasId).off("click")},q=function(a){return"#"+a.attr("id").split("#")[1]},r=function(c){a("#"+b.canvasId).on("mousemove",function(b){void 0!==b.buttons&&1===b.buttons&&i.fillRect(b.pageX-a(this).offset().left,b.pageY-a(this).offset().top,2,2)})},s=function(c){a("#"+b.canvasId).off("mousemove")},t=function(b,c){null!==v&&v.trigger("click"),a(b.tool).toggleClass("active-tool"),c(b)},u=function(b,c){a(b.tool).toggleClass("active-tool"),c(b)},v=null,w=function(){a("#FreeStyleSpeedDotsTool").funcToggle("click",function(){t({tool:this},l),v=a(this)},function(){v=null,u({tool:this},m)})},x=function(){a("#CircleStampTool").funcToggle("click",function(){t({tool:this},o),v=a(this)},function(){v=null,u({tool:this},p)})},y=function(){a("#PencilTool").funcToggle("click",function(){t({tool:this},r),v=a(this)},function(){v=null,u({tool:this},s)})},z=function(){a(".color").on("click",function(){g=i.fillStyle=q(a(this))}).on("contextmenu",function(){f=q(a(this))})},A=function(b){a("#"+b.containerId+" #"+b.toolId).on("input",function(){g=i.fillStyle=a(this).val()})},B=function(c){a("#"+c.toolId).on("click",function(){window.open(a("#"+b.canvasId)[0].toDataURL("image/png"),"_blank")})},C=function(c){a("#"+c.toolId).on("click",function(){var c=a("#"+b.canvasId)[0],d=c.height,e=c.width,f=c.getContext("2d");f.save(),f.transform(1,0,0,1,0,0),f.fillStyle=h,f.fillRect(0,0,e,d),f.restore()})},D=function(){z(),y(),x(),w(),A({toolId:"allColorsPicker",containerId:"HTML5ColorPicker"}),B({toolId:"save-as-image",containerId:"SaveImageButton"}),C({toolId:"reset-canvas",containerId:"ResetCanvas"})},E=function(){a("#jspaint-paint-area").css({width:d,height:e})},F=function(){a("."+b.maintoolsClass).attr("title","Click to activate;\nRight-click to deactivate;")},G=function(){a(".top-taker").TopTaker({theme:"dark"})},H=function(){E(),i=k(),F(),G(),j(),D(),a("#PencilTool").trigger("click")};H()})}(jQuery);